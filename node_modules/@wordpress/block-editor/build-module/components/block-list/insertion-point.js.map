{"version":3,"sources":["@wordpress/block-editor/src/components/block-list/insertion-point.js"],"names":["classnames","useSelect","useDispatch","useState","useEffect","useCallback","useRef","useMemo","Popover","isRTL","Inserter","getBlockDOMNode","InsertionPointInserter","clientId","rootClientId","setIsInserterForced","InsertionPointPopover","selectedRootClientId","isInserterShown","isInserterForced","containerRef","showInsertionPoint","selectBlock","ref","select","getBlockOrder","getBlockRootClientId","getBlockListSettings","getMultiSelectedBlockClientIds","getSelectedBlockClientId","hasMultiSelection","getSettings","ownerDocument","current","targetRootClientId","blockOrder","length","previous","isLast","next","indexOf","hasReducedUI","multiSelectedBlockClientIds","selectedBlockClientId","blockOrientation","orientation","previousElement","nextElement","nextClientId","isHidden","includes","style","previousRect","getBoundingClientRect","nextRect","width","offsetWidth","height","top","bottom","left","right","offsetHeight","getAnchorRect","className","onClick","event","target","onFocus","useInsertionPoint","setIsInserterShown","inserterClientId","setInserterClientId","_isMultiSelecting","isMultiSelecting","isBlockInsertionPointVisible","getBlockInsertionPoint","_getBlockListSettings","insertionPoint","order","isInserterVisible","selectedClientId","index","onMouseMove","classList","contains","blockElement","getAttribute","closest","rect","offsetTop","clientY","offsetLeft","clientX","children","Array","from","find","blockEl","element","id","firstElementChild","slice","elementRect","enableMouseMove","addEventListener","removeEventListener","isVisible","value"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport {\n\tuseState,\n\tuseEffect,\n\tuseCallback,\n\tuseRef,\n\tuseMemo,\n} from '@wordpress/element';\nimport { Popover } from '@wordpress/components';\nimport { isRTL } from '@wordpress/i18n';\n\n/**\n * Internal dependencies\n */\nimport Inserter from '../inserter';\nimport { getBlockDOMNode } from '../../utils/dom';\n\nfunction InsertionPointInserter( {\n\tclientId,\n\trootClientId,\n\tsetIsInserterForced,\n} ) {\n\treturn (\n\t\t<div\n\t\t\tclassName={ classnames(\n\t\t\t\t'block-editor-block-list__insertion-point-inserter'\n\t\t\t) }\n\t\t>\n\t\t\t<Inserter\n\t\t\t\tposition=\"bottom center\"\n\t\t\t\tclientId={ clientId }\n\t\t\t\trootClientId={ rootClientId }\n\t\t\t\t__experimentalIsQuick\n\t\t\t\tonToggle={ setIsInserterForced }\n\t\t\t\tonSelectOrClose={ () => setIsInserterForced( false ) }\n\t\t\t/>\n\t\t</div>\n\t);\n}\n\nfunction InsertionPointPopover( {\n\tclientId,\n\tselectedRootClientId,\n\tisInserterShown,\n\tisInserterForced,\n\tsetIsInserterForced,\n\tcontainerRef,\n\tshowInsertionPoint,\n} ) {\n\tconst { selectBlock } = useDispatch( 'core/block-editor' );\n\tconst ref = useRef();\n\n\tconst {\n\t\tpreviousElement,\n\t\tnextElement,\n\t\torientation,\n\t\tisHidden,\n\t\tnextClientId,\n\t\trootClientId,\n\t} = useSelect(\n\t\t( select ) => {\n\t\t\tconst {\n\t\t\t\tgetBlockOrder,\n\t\t\t\tgetBlockRootClientId,\n\t\t\t\tgetBlockListSettings,\n\t\t\t\tgetMultiSelectedBlockClientIds,\n\t\t\t\tgetSelectedBlockClientId,\n\t\t\t\thasMultiSelection,\n\t\t\t\tgetSettings,\n\t\t\t} = select( 'core/block-editor' );\n\t\t\tconst { ownerDocument } = containerRef.current;\n\t\t\tconst targetRootClientId = clientId\n\t\t\t\t? getBlockRootClientId( clientId )\n\t\t\t\t: selectedRootClientId;\n\t\t\tconst blockOrder = getBlockOrder( targetRootClientId );\n\t\t\tif ( ! blockOrder.length ) {\n\t\t\t\treturn {};\n\t\t\t}\n\t\t\tconst previous = clientId\n\t\t\t\t? clientId\n\t\t\t\t: blockOrder[ blockOrder.length - 1 ];\n\t\t\tconst isLast = previous === blockOrder[ blockOrder.length - 1 ];\n\t\t\tconst next = isLast\n\t\t\t\t? null\n\t\t\t\t: blockOrder[ blockOrder.indexOf( previous ) + 1 ];\n\t\t\tconst { hasReducedUI } = getSettings();\n\t\t\tconst multiSelectedBlockClientIds = getMultiSelectedBlockClientIds();\n\t\t\tconst selectedBlockClientId = getSelectedBlockClientId();\n\t\t\tconst blockOrientation =\n\t\t\t\tgetBlockListSettings( targetRootClientId )?.orientation ||\n\t\t\t\t'vertical';\n\n\t\t\treturn {\n\t\t\t\tpreviousElement: getBlockDOMNode( previous, ownerDocument ),\n\t\t\t\tnextElement: getBlockDOMNode( next, ownerDocument ),\n\t\t\t\tnextClientId: next,\n\t\t\t\tisHidden:\n\t\t\t\t\thasReducedUI ||\n\t\t\t\t\t( hasMultiSelection()\n\t\t\t\t\t\t? next && multiSelectedBlockClientIds.includes( next )\n\t\t\t\t\t\t: next &&\n\t\t\t\t\t\t  blockOrientation === 'vertical' &&\n\t\t\t\t\t\t  next === selectedBlockClientId ),\n\t\t\t\torientation: blockOrientation,\n\t\t\t\trootClientId: targetRootClientId,\n\t\t\t};\n\t\t},\n\t\t[ clientId, selectedRootClientId ]\n\t);\n\n\tconst style = useMemo( () => {\n\t\tif ( ! previousElement ) {\n\t\t\treturn {};\n\t\t}\n\t\tconst previousRect = previousElement.getBoundingClientRect();\n\t\tconst nextRect = nextElement\n\t\t\t? nextElement.getBoundingClientRect()\n\t\t\t: null;\n\n\t\tif ( orientation === 'vertical' ) {\n\t\t\treturn {\n\t\t\t\twidth: previousElement.offsetWidth,\n\t\t\t\theight: nextRect ? nextRect.top - previousRect.bottom : 0,\n\t\t\t};\n\t\t}\n\n\t\tlet width = 0;\n\t\tif ( nextElement ) {\n\t\t\twidth = isRTL()\n\t\t\t\t? previousRect.left - nextRect.right\n\t\t\t\t: nextRect.left - previousRect.right;\n\t\t}\n\n\t\treturn {\n\t\t\twidth,\n\t\t\theight: previousElement.offsetHeight,\n\t\t};\n\t}, [ previousElement, nextElement ] );\n\n\tconst getAnchorRect = useCallback( () => {\n\t\tconst previousRect = previousElement.getBoundingClientRect();\n\t\tconst nextRect = nextElement\n\t\t\t? nextElement.getBoundingClientRect()\n\t\t\t: null;\n\t\tif ( orientation === 'vertical' ) {\n\t\t\treturn {\n\t\t\t\ttop: previousRect.bottom,\n\t\t\t\tleft: previousRect.left,\n\t\t\t\tright: previousRect.right,\n\t\t\t\tbottom: nextRect ? nextRect.top : previousRect.bottom,\n\t\t\t};\n\t\t}\n\n\t\tif ( isRTL() ) {\n\t\t\treturn {\n\t\t\t\ttop: previousRect.top,\n\t\t\t\tleft: nextRect ? nextRect.right : previousRect.left,\n\t\t\t\tright: previousRect.left,\n\t\t\t\tbottom: previousRect.bottom,\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\ttop: previousRect.top,\n\t\t\tleft: previousRect.right,\n\t\t\tright: nextRect ? nextRect.left : previousRect.right,\n\t\t\tbottom: previousRect.bottom,\n\t\t};\n\t}, [ previousElement, nextElement ] );\n\n\tif ( ! previousElement ) {\n\t\treturn null;\n\t}\n\n\tconst className = classnames(\n\t\t'block-editor-block-list__insertion-point',\n\t\t'is-' + orientation\n\t);\n\n\tfunction onClick( event ) {\n\t\tif ( event.target === ref.current && nextClientId ) {\n\t\t\tselectBlock( nextClientId, -1 );\n\t\t}\n\t}\n\n\tfunction onFocus( event ) {\n\t\t// Only handle click on the wrapper specifically, and not an event\n\t\t// bubbled from the inserter itself.\n\t\tif ( event.target !== ref.current ) {\n\t\t\tsetIsInserterForced( true );\n\t\t}\n\t}\n\n\t/* eslint-disable jsx-a11y/no-static-element-interactions, jsx-a11y/click-events-have-key-events */\n\t// While ideally it would be enough to capture the\n\t// bubbling focus event from the Inserter, due to the\n\t// characteristics of click focusing of `button`s in\n\t// Firefox and Safari, it is not reliable.\n\t//\n\t// See: https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button#Clicking_and_focus\n\treturn (\n\t\t<Popover\n\t\t\tnoArrow\n\t\t\tanimate={ false }\n\t\t\tgetAnchorRect={ getAnchorRect }\n\t\t\tfocusOnMount={ false }\n\t\t\tclassName=\"block-editor-block-list__insertion-point-popover\"\n\t\t\t__unstableSlotName=\"block-toolbar\"\n\t\t>\n\t\t\t<div\n\t\t\t\tref={ ref }\n\t\t\t\ttabIndex={ -1 }\n\t\t\t\tonClick={ onClick }\n\t\t\t\tonFocus={ onFocus }\n\t\t\t\tclassName={ className }\n\t\t\t\tstyle={ style }\n\t\t\t>\n\t\t\t\t{ ! isHidden &&\n\t\t\t\t\t( showInsertionPoint ||\n\t\t\t\t\t\tisInserterShown ||\n\t\t\t\t\t\tisInserterForced ) && (\n\t\t\t\t\t\t<div className=\"block-editor-block-list__insertion-point-indicator\" />\n\t\t\t\t\t) }\n\t\t\t\t{ ! isHidden && ( isInserterShown || isInserterForced ) && (\n\t\t\t\t\t<InsertionPointInserter\n\t\t\t\t\t\trootClientId={ rootClientId }\n\t\t\t\t\t\tclientId={ nextClientId }\n\t\t\t\t\t\tsetIsInserterForced={ setIsInserterForced }\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t</div>\n\t\t</Popover>\n\t);\n\t/* eslint-enable jsx-a11y/no-static-element-interactions, jsx-a11y/click-events-have-key-events */\n}\n\nexport default function useInsertionPoint( ref ) {\n\tconst [ isInserterShown, setIsInserterShown ] = useState( false );\n\tconst [ isInserterForced, setIsInserterForced ] = useState( false );\n\tconst [ inserterClientId, setInserterClientId ] = useState( null );\n\tconst {\n\t\tisMultiSelecting,\n\t\tisInserterVisible,\n\t\tselectedClientId,\n\t\tselectedRootClientId,\n\t\tgetBlockListSettings,\n\t} = useSelect( ( select ) => {\n\t\tconst {\n\t\t\tisMultiSelecting: _isMultiSelecting,\n\t\t\tisBlockInsertionPointVisible,\n\t\t\tgetBlockInsertionPoint,\n\t\t\tgetBlockOrder,\n\t\t\tgetBlockListSettings: _getBlockListSettings,\n\t\t} = select( 'core/block-editor' );\n\n\t\tconst insertionPoint = getBlockInsertionPoint();\n\t\tconst order = getBlockOrder( insertionPoint.rootClientId );\n\n\t\treturn {\n\t\t\tgetBlockListSettings: _getBlockListSettings,\n\t\t\tisMultiSelecting: _isMultiSelecting(),\n\t\t\tisInserterVisible: isBlockInsertionPointVisible(),\n\t\t\tselectedClientId: order[ insertionPoint.index - 1 ],\n\t\t\tselectedRootClientId: insertionPoint.rootClientId,\n\t\t};\n\t}, [] );\n\n\tconst onMouseMove = useCallback(\n\t\t( event ) => {\n\t\t\tif (\n\t\t\t\t! event.target.classList.contains(\n\t\t\t\t\t'block-editor-block-list__layout'\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tif ( isInserterShown ) {\n\t\t\t\t\tsetIsInserterShown( false );\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet rootClientId;\n\t\t\tif ( ! event.target.classList.contains( 'is-root-container' ) ) {\n\t\t\t\tconst blockElement = !! event.target.getAttribute(\n\t\t\t\t\t'data-block'\n\t\t\t\t)\n\t\t\t\t\t? event.target\n\t\t\t\t\t: event.target.closest( '[data-block]' );\n\t\t\t\trootClientId = blockElement.getAttribute( 'data-block' );\n\t\t\t}\n\n\t\t\tconst orientation =\n\t\t\t\tgetBlockListSettings( rootClientId )?.orientation || 'vertical';\n\t\t\tconst rect = event.target.getBoundingClientRect();\n\t\t\tconst offsetTop = event.clientY - rect.top;\n\t\t\tconst offsetLeft = event.clientX - rect.left;\n\n\t\t\tconst children = Array.from( event.target.children );\n\t\t\tconst nextElement = children.find( ( blockEl ) => {\n\t\t\t\treturn (\n\t\t\t\t\t( orientation === 'vertical' &&\n\t\t\t\t\t\tblockEl.offsetTop > offsetTop ) ||\n\t\t\t\t\t( orientation === 'horizontal' &&\n\t\t\t\t\t\tblockEl.offsetLeft > offsetLeft )\n\t\t\t\t);\n\t\t\t} );\n\n\t\t\tlet element = nextElement\n\t\t\t\t? children[ children.indexOf( nextElement ) - 1 ]\n\t\t\t\t: children[ children.length - 1 ];\n\n\t\t\tif ( ! element ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// The block may be in an alignment wrapper, so check the first direct\n\t\t\t// child if the element has no ID.\n\t\t\tif ( ! element.id ) {\n\t\t\t\telement = element.firstElementChild;\n\n\t\t\t\tif ( ! element ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst clientId = element.id.slice( 'block-'.length );\n\n\t\t\tif ( ! clientId ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst elementRect = element.getBoundingClientRect();\n\n\t\t\tif (\n\t\t\t\t( orientation === 'horizontal' &&\n\t\t\t\t\t( event.clientY > elementRect.bottom ||\n\t\t\t\t\t\tevent.clientY < elementRect.top ) ) ||\n\t\t\t\t( orientation === 'vertical' &&\n\t\t\t\t\t( event.clientX > elementRect.right ||\n\t\t\t\t\t\tevent.clientX < elementRect.left ) )\n\t\t\t) {\n\t\t\t\tif ( isInserterShown ) {\n\t\t\t\t\tsetIsInserterShown( false );\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tsetIsInserterShown( true );\n\t\t\tsetInserterClientId( clientId );\n\t\t},\n\t\t[ isInserterShown, setIsInserterShown, setInserterClientId ]\n\t);\n\n\tconst enableMouseMove = ! isInserterForced && ! isMultiSelecting;\n\n\tuseEffect( () => {\n\t\tif ( ! enableMouseMove ) {\n\t\t\treturn;\n\t\t}\n\n\t\tref.current.addEventListener( 'mousemove', onMouseMove );\n\n\t\treturn () => {\n\t\t\tref.current.removeEventListener( 'mousemove', onMouseMove );\n\t\t};\n\t}, [ enableMouseMove, onMouseMove ] );\n\n\tconst isVisible = isInserterShown || isInserterForced || isInserterVisible;\n\n\treturn (\n\t\t! isMultiSelecting &&\n\t\tisVisible && (\n\t\t\t<InsertionPointPopover\n\t\t\t\tclientId={\n\t\t\t\t\tisInserterVisible ? selectedClientId : inserterClientId\n\t\t\t\t}\n\t\t\t\tselectedRootClientId={ selectedRootClientId }\n\t\t\t\tisInserterShown={ isInserterShown }\n\t\t\t\tisInserterForced={ isInserterForced }\n\t\t\t\tsetIsInserterForced={ ( value ) => {\n\t\t\t\t\tsetIsInserterForced( value );\n\t\t\t\t\tif ( ! value ) {\n\t\t\t\t\t\tsetIsInserterShown( value );\n\t\t\t\t\t}\n\t\t\t\t} }\n\t\t\t\tcontainerRef={ ref }\n\t\t\t\tshowInsertionPoint={ isInserterVisible }\n\t\t\t/>\n\t\t)\n\t);\n}\n"]}