{"version":3,"sources":["@wordpress/block-editor/src/components/inserter/hooks/use-insertion-point.js"],"names":["useDispatch","useSelect","isUnmodifiedDefaultBlock","_n","speak","useCallback","useInsertionPoint","rootClientId","insertionIndex","clientId","isAppender","selectBlockOnInsert","onSelect","select","getSelectedBlock","getBlockIndex","getBlockOrder","getBlockInsertionPoint","_destinationRootClientId","_destinationIndex","length","insertionPoint","index","selectedBlock","destinationRootClientId","destinationIndex","replaceBlocks","insertBlocks","showInsertionPoint","hideInsertionPoint","onInsertBlocks","blocks","meta","message","onToggleInsertionPoint","show"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { isUnmodifiedDefaultBlock } from '@wordpress/blocks';\nimport { _n } from '@wordpress/i18n';\nimport { speak } from '@wordpress/a11y';\nimport { useCallback } from '@wordpress/element';\n\n/**\n * @typedef WPInserterConfig\n *\n * @property {string=}   rootClientId        If set, insertion will be into the\n *                                           block with this ID.\n * @property {number=}   insertionIndex      If set, insertion will be into this\n *                                           explicit position.\n * @property {string=}   clientId            If set, insertion will be after the\n *                                           block with this ID.\n * @property {boolean=}  isAppender          Whether the inserter is an appender\n *                                           or not.\n * @property {boolean=}  selectBlockOnInsert Whether the block should be\n *                                           selected on insert.\n * @property {Function=} onSelect            Called after insertion.\n */\n\n/**\n * Returns the insertion point state given the inserter config.\n *\n * @param {WPInserterConfig} config Inserter Config.\n * @return {Array} Insertion Point State (rootClientID, onInsertBlocks and onToggle).\n */\nfunction useInsertionPoint( {\n\trootClientId,\n\tinsertionIndex,\n\tclientId,\n\tisAppender,\n\tselectBlockOnInsert,\n\tonSelect,\n} ) {\n\tconst {\n\t\tselectedBlock,\n\t\tdestinationRootClientId,\n\t\tdestinationIndex,\n\t} = useSelect(\n\t\t( select ) => {\n\t\t\tconst {\n\t\t\t\tgetSelectedBlock,\n\t\t\t\tgetBlockIndex,\n\t\t\t\tgetBlockOrder,\n\t\t\t\tgetBlockInsertionPoint,\n\t\t\t} = select( 'core/block-editor' );\n\n\t\t\tlet _destinationRootClientId, _destinationIndex;\n\n\t\t\tif ( rootClientId || insertionIndex || clientId || isAppender ) {\n\t\t\t\t// If any of these arguments are set, we're in \"manual mode\"\n\t\t\t\t// meaning the insertion point is set by the caller.\n\n\t\t\t\t_destinationRootClientId = rootClientId;\n\n\t\t\t\tif ( insertionIndex ) {\n\t\t\t\t\t// Insert into a specific index.\n\t\t\t\t\t_destinationIndex = insertionIndex;\n\t\t\t\t} else if ( clientId ) {\n\t\t\t\t\t// Insert after a specific client ID.\n\t\t\t\t\t_destinationIndex = getBlockIndex(\n\t\t\t\t\t\tclientId,\n\t\t\t\t\t\t_destinationRootClientId\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\t// Insert at the end of the list.\n\t\t\t\t\t_destinationIndex = getBlockOrder(\n\t\t\t\t\t\t_destinationRootClientId\n\t\t\t\t\t).length;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Otherwise, we're in \"auto mode\" where the insertion point is\n\t\t\t\t// decided by getBlockInsertionPoint().\n\t\t\t\tconst insertionPoint = getBlockInsertionPoint();\n\t\t\t\t_destinationRootClientId = insertionPoint.rootClientId;\n\t\t\t\t_destinationIndex = insertionPoint.index;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tselectedBlock: getSelectedBlock(),\n\t\t\t\tdestinationRootClientId: _destinationRootClientId,\n\t\t\t\tdestinationIndex: _destinationIndex,\n\t\t\t};\n\t\t},\n\t\t[ rootClientId, insertionIndex, clientId, isAppender ]\n\t);\n\n\tconst {\n\t\treplaceBlocks,\n\t\tinsertBlocks,\n\t\tshowInsertionPoint,\n\t\thideInsertionPoint,\n\t} = useDispatch( 'core/block-editor' );\n\n\tconst onInsertBlocks = useCallback(\n\t\t( blocks, meta ) => {\n\t\t\tif (\n\t\t\t\t! isAppender &&\n\t\t\t\tselectedBlock &&\n\t\t\t\tisUnmodifiedDefaultBlock( selectedBlock )\n\t\t\t) {\n\t\t\t\treplaceBlocks(\n\t\t\t\t\tselectedBlock.clientId,\n\t\t\t\t\tblocks,\n\t\t\t\t\tnull,\n\t\t\t\t\tnull,\n\t\t\t\t\tmeta\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tinsertBlocks(\n\t\t\t\t\tblocks,\n\t\t\t\t\tdestinationIndex,\n\t\t\t\t\tdestinationRootClientId,\n\t\t\t\t\tselectBlockOnInsert,\n\t\t\t\t\tmeta\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif ( ! selectBlockOnInsert ) {\n\t\t\t\t// translators: %d: the name of the block that has been added\n\t\t\t\tconst message = _n(\n\t\t\t\t\t'%d block added.',\n\t\t\t\t\t'%d blocks added.',\n\t\t\t\t\tblocks.length\n\t\t\t\t);\n\t\t\t\tspeak( message );\n\t\t\t}\n\n\t\t\tif ( onSelect ) {\n\t\t\t\tonSelect();\n\t\t\t}\n\t\t},\n\t\t[\n\t\t\tisAppender,\n\t\t\tselectedBlock,\n\t\t\treplaceBlocks,\n\t\t\tinsertBlocks,\n\t\t\tdestinationRootClientId,\n\t\t\tdestinationIndex,\n\t\t\tselectBlockOnInsert,\n\t\t\tonSelect,\n\t\t]\n\t);\n\n\tconst onToggleInsertionPoint = useCallback(\n\t\t( show ) => {\n\t\t\tif ( show ) {\n\t\t\t\tshowInsertionPoint( destinationRootClientId, destinationIndex );\n\t\t\t} else {\n\t\t\t\thideInsertionPoint();\n\t\t\t}\n\t\t},\n\t\t[\n\t\t\tshowInsertionPoint,\n\t\t\thideInsertionPoint,\n\t\t\tdestinationRootClientId,\n\t\t\tdestinationIndex,\n\t\t]\n\t);\n\n\treturn [ destinationRootClientId, onInsertBlocks, onToggleInsertionPoint ];\n}\n\nexport default useInsertionPoint;\n"]}