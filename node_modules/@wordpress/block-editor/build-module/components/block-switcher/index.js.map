{"version":3,"sources":["@wordpress/block-editor/src/components/block-switcher/index.js"],"names":["castArray","uniq","truncate","__","_n","sprintf","DropdownMenu","ToolbarButton","ToolbarGroup","ToolbarItem","switchToBlockType","store","blocksStore","isReusableBlock","useSelect","useDispatch","stack","blockEditorStore","useBlockDisplayInformation","BlockIcon","BlockTransformationsMenu","BlockStylesMenu","BlockSwitcherDropdownMenu","clientIds","blocks","replaceBlocks","blockInformation","clientId","select","getBlockRootClientId","getBlockTransformItems","__experimentalGetReusableBlockTitle","getBlockStyles","getBlockType","rootClientId","firstBlockName","name","_isSingleBlockSelected","length","styles","_icon","reusableBlockTitle","icon","attributes","ref","isSelectionOfSameType","map","possibleBlockTransformations","hasBlockStyles","blockTitle","title","isReusable","onTransform","hasPossibleBlockTransformations","blockSwitcherLabel","blockSwitcherDescription","toggleProps","position","isAlternate","className","describedBy","orientation","onClose","BlockSwitcher","getBlocksByClientId","some","block"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { castArray, uniq, truncate } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { __, _n, sprintf } from '@wordpress/i18n';\nimport {\n\tDropdownMenu,\n\tToolbarButton,\n\tToolbarGroup,\n\tToolbarItem,\n} from '@wordpress/components';\nimport {\n\tswitchToBlockType,\n\tstore as blocksStore,\n\tisReusableBlock,\n} from '@wordpress/blocks';\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport { stack } from '@wordpress/icons';\n\n/**\n * Internal dependencies\n */\nimport { store as blockEditorStore } from '../../store';\nimport useBlockDisplayInformation from '../use-block-display-information';\nimport BlockIcon from '../block-icon';\nimport BlockTransformationsMenu from './block-transformations-menu';\nimport BlockStylesMenu from './block-styles-menu';\n\nexport const BlockSwitcherDropdownMenu = ( { clientIds, blocks } ) => {\n\tconst { replaceBlocks } = useDispatch( blockEditorStore );\n\tconst blockInformation = useBlockDisplayInformation( blocks[ 0 ].clientId );\n\tconst {\n\t\tpossibleBlockTransformations,\n\t\thasBlockStyles,\n\t\ticon,\n\t\tblockTitle,\n\t} = useSelect(\n\t\t( select ) => {\n\t\t\tconst {\n\t\t\t\tgetBlockRootClientId,\n\t\t\t\tgetBlockTransformItems,\n\t\t\t\t__experimentalGetReusableBlockTitle,\n\t\t\t} = select( blockEditorStore );\n\n\t\t\tconst { getBlockStyles, getBlockType } = select( blocksStore );\n\t\t\tconst rootClientId = getBlockRootClientId(\n\t\t\t\tcastArray( clientIds )[ 0 ]\n\t\t\t);\n\t\t\tconst [ { name: firstBlockName } ] = blocks;\n\t\t\tconst _isSingleBlockSelected = blocks.length === 1;\n\t\t\tconst styles =\n\t\t\t\t_isSingleBlockSelected && getBlockStyles( firstBlockName );\n\t\t\tlet _icon;\n\t\t\tlet reusableBlockTitle;\n\t\t\tif ( _isSingleBlockSelected ) {\n\t\t\t\t_icon = blockInformation?.icon; // Take into account active block variations.\n\t\t\t\treusableBlockTitle =\n\t\t\t\t\tisReusableBlock( blocks[ 0 ] ) &&\n\t\t\t\t\t__experimentalGetReusableBlockTitle(\n\t\t\t\t\t\tblocks[ 0 ].attributes.ref\n\t\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tconst isSelectionOfSameType =\n\t\t\t\t\tuniq( blocks.map( ( { name } ) => name ) ).length === 1;\n\t\t\t\t// When selection consists of blocks of multiple types, display an\n\t\t\t\t// appropriate icon to communicate the non-uniformity.\n\t\t\t\t_icon = isSelectionOfSameType\n\t\t\t\t\t? getBlockType( firstBlockName )?.icon\n\t\t\t\t\t: stack;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tpossibleBlockTransformations: getBlockTransformItems(\n\t\t\t\t\tblocks,\n\t\t\t\t\trootClientId\n\t\t\t\t),\n\t\t\t\thasBlockStyles: !! styles?.length,\n\t\t\t\ticon: _icon,\n\t\t\t\tblockTitle:\n\t\t\t\t\treusableBlockTitle || getBlockType( firstBlockName ).title,\n\t\t\t};\n\t\t},\n\t\t[ clientIds, blocks, blockInformation?.icon ]\n\t);\n\n\tconst isReusable = blocks.length === 1 && isReusableBlock( blocks[ 0 ] );\n\n\tconst onTransform = ( name ) =>\n\t\treplaceBlocks( clientIds, switchToBlockType( blocks, name ) );\n\tconst hasPossibleBlockTransformations = !! possibleBlockTransformations.length;\n\tif ( ! hasBlockStyles && ! hasPossibleBlockTransformations ) {\n\t\treturn (\n\t\t\t<ToolbarGroup>\n\t\t\t\t<ToolbarButton\n\t\t\t\t\tdisabled\n\t\t\t\t\tclassName=\"block-editor-block-switcher__no-switcher-icon\"\n\t\t\t\t\ttitle={ blockTitle }\n\t\t\t\t\ticon={ <BlockIcon icon={ icon } showColors /> }\n\t\t\t\t/>\n\t\t\t</ToolbarGroup>\n\t\t);\n\t}\n\n\tconst blockSwitcherLabel = blockTitle;\n\n\tconst blockSwitcherDescription =\n\t\t1 === blocks.length\n\t\t\t? __( 'Change block type or style' )\n\t\t\t: sprintf(\n\t\t\t\t\t/* translators: %s: number of blocks. */\n\t\t\t\t\t_n(\n\t\t\t\t\t\t'Change type of %d block',\n\t\t\t\t\t\t'Change type of %d blocks',\n\t\t\t\t\t\tblocks.length\n\t\t\t\t\t),\n\t\t\t\t\tblocks.length\n\t\t\t  );\n\n\treturn (\n\t\t<ToolbarGroup>\n\t\t\t<ToolbarItem>\n\t\t\t\t{ ( toggleProps ) => (\n\t\t\t\t\t<DropdownMenu\n\t\t\t\t\t\tclassName=\"block-editor-block-switcher\"\n\t\t\t\t\t\tlabel={ blockSwitcherLabel }\n\t\t\t\t\t\tpopoverProps={ {\n\t\t\t\t\t\t\tposition: 'bottom right',\n\t\t\t\t\t\t\tisAlternate: true,\n\t\t\t\t\t\t\tclassName: 'block-editor-block-switcher__popover',\n\t\t\t\t\t\t} }\n\t\t\t\t\t\ticon={\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<BlockIcon\n\t\t\t\t\t\t\t\t\ticon={ icon }\n\t\t\t\t\t\t\t\t\tclassName=\"block-editor-block-switcher__toggle\"\n\t\t\t\t\t\t\t\t\tshowColors\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t{ isReusable && (\n\t\t\t\t\t\t\t\t\t<span className=\"block-editor-block-switcher__toggle-text\">\n\t\t\t\t\t\t\t\t\t\t{ truncate( blockTitle, {\n\t\t\t\t\t\t\t\t\t\t\tlength: 35,\n\t\t\t\t\t\t\t\t\t\t} ) }\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttoggleProps={ {\n\t\t\t\t\t\t\tdescribedBy: blockSwitcherDescription,\n\t\t\t\t\t\t\t...toggleProps,\n\t\t\t\t\t\t} }\n\t\t\t\t\t\tmenuProps={ { orientation: 'both' } }\n\t\t\t\t\t>\n\t\t\t\t\t\t{ ( { onClose } ) =>\n\t\t\t\t\t\t\t( hasBlockStyles ||\n\t\t\t\t\t\t\t\thasPossibleBlockTransformations ) && (\n\t\t\t\t\t\t\t\t<div className=\"block-editor-block-switcher__container\">\n\t\t\t\t\t\t\t\t\t{ hasPossibleBlockTransformations && (\n\t\t\t\t\t\t\t\t\t\t<BlockTransformationsMenu\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"block-editor-block-switcher__transforms__menugroup\"\n\t\t\t\t\t\t\t\t\t\t\tpossibleBlockTransformations={\n\t\t\t\t\t\t\t\t\t\t\t\tpossibleBlockTransformations\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tblocks={ blocks }\n\t\t\t\t\t\t\t\t\t\t\tonSelect={ ( name ) => {\n\t\t\t\t\t\t\t\t\t\t\t\tonTransform( name );\n\t\t\t\t\t\t\t\t\t\t\t\tonClose();\n\t\t\t\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t{ hasBlockStyles && (\n\t\t\t\t\t\t\t\t\t\t<BlockStylesMenu\n\t\t\t\t\t\t\t\t\t\t\thoveredBlock={ blocks[ 0 ] }\n\t\t\t\t\t\t\t\t\t\t\tonSwitch={ onClose }\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t}\n\t\t\t\t\t</DropdownMenu>\n\t\t\t\t) }\n\t\t\t</ToolbarItem>\n\t\t</ToolbarGroup>\n\t);\n};\n\nexport const BlockSwitcher = ( { clientIds } ) => {\n\tconst blocks = useSelect(\n\t\t( select ) =>\n\t\t\tselect( blockEditorStore ).getBlocksByClientId( clientIds ),\n\t\t[ clientIds ]\n\t);\n\n\tif ( ! blocks.length || blocks.some( ( block ) => ! block ) ) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<BlockSwitcherDropdownMenu clientIds={ clientIds } blocks={ blocks } />\n\t);\n};\n\nexport default BlockSwitcher;\n"]}