{"version":3,"sources":["@wordpress/rich-text/src/component/index.native.js"],"names":["RCTAztecView","View","Platform","showUserSuggestions","showXpostSuggestions","get","pickBy","debounce","isString","memize","BlockFormatControls","Component","compose","withPreferredColorScheme","withSelect","childrenBlock","decodeEntities","BACKSPACE","DELETE","ENTER","isURL","atSymbol","plus","__","useFormatTypes","FormatEdit","applyFormat","getActiveFormat","getActiveFormats","insert","getTextContent","isEmpty","isEmptyLine","create","toHTMLString","removeLineSeparator","isCollapsed","remove","styles","ToolbarButtonWithOptions","unescapeSpaces","text","replace","gutenbergFormatNamesToAztec","EMPTY_PARAGRAPH_TAGS","RichText","value","selectionStart","selectionEnd","multiline","__unstableMultilineTag","arguments","isMultiline","multilineTag","multilineWrapperTags","isIOS","OS","createRecord","bind","restoreParagraphTags","onChangeFromAztec","onKeyDown","handleEnter","handleDelete","onPaste","onFocus","onBlur","onTextUpdate","onContentSizeChange","onFormatChange","formatToValue","maxSize","debounceCreateUndoLevel","onCreateUndoLevel","onSelectionChange","onSelectionChangeFromAztec","valueToFormat","getHtmlToRender","handleSuggestionFunc","handleUserSuggestion","handleXpostSuggestion","suggestionOptions","insertString","convertFontSizeFromString","state","activeFormats","selectedFormat","height","needsSelectionUpdate","savedContent","isTouched","lastAztecEventType","lastHistoryValue","props","start","end","formats","replacements","preserveWhiteSpace","html","range","Math","min","length","removeRootTagsProduceByAztec","record","formatTypes","map","name","filter","undefined","Boolean","changeHandlers","v","key","startsWith","Object","values","forEach","changeHandler","onChange","setState","string","lastEventCount","toInsert","__unstableOnCreateUndoLevel","result","removeRootTag","tagName","rootTagsToEliminate","element","tagsToEliminate","removeTag","tag","openingTagRegexp","RegExp","closingTagRegexp","fontSize","endsWith","parseFloat","substring","event","contentWithoutRootTag","nativeEvent","eventCount","comesFromAztec","firedAfterTextChanged","formattedContent","refresh","contentSize","defaultPrevented","handleTriggerKeyCodes","keyCode","onEnter","shiftKey","isReverse","onDelete","newValue","preventDefault","triggeredOption","find","option","triggeredKeyCode","triggerChar","charCodeAt","getRecord","useTrigger","charAt","onClick","areMentionsSupported","areXPostsSupported","allOptions","supported","title","label","icon","op","suggestionFunction","prefix","then","suggestion","catch","pastedText","pastedHtml","files","currentRecord","trimmedText","trim","linkedRecord","type","attributes","href","window","console","log","plainText","unstableOnFocus","hasChanged","isManual","realStart","realEnd","max","__unstableIsSelected","Array","isArray","toHTML","format","nextProps","reversed","blockIsSelected","__unstableMobileNoFocusOnMount","_editor","focus","isFocused","blur","prevProps","isSelected","prevIsSelected","extraAttributes","style","children","getStylesFromColorScheme","minWidth","maxWidth","parentBlockStyles","accessibilityLabel","disableEditingMenu","placeholderStyle","richTextPlaceholder","richTextPlaceholderDark","defaultPlaceholderTextColor","color","richText","richTextDark","defaultColor","defaultTextDecorationColor","textDecorationColor","defaultFontFamily","fontFamily","selection","brBeforeParaMatches","match","warn","count","newSelectionStart","newSelectionEnd","width","containerStyles","padding","backgroundColor","ref","setRef","minHeight","linkTextColor","placeholder","placeholderTextColor","deleteEnter","getActiveFormatNames","onCaretVerticalPositionChange","fontWeight","fontStyle","textAlign","id","selectionColor","defaultProps","withFormatTypes","WrappedComponent","clientId","identifier","withoutInteractiveFormatting","select","getBlockParents","getBlock","getSettings","parents","parentBlock","mentions","xposts"],"mappings":"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","sourcesContent":["/*eslint no-console: [\"error\", { allow: [\"warn\"] }] */\n\n/**\n * External dependencies\n */\n/**\n * WordPress dependencies\n */\nimport RCTAztecView from '@wordpress/react-native-aztec';\nimport { View, Platform } from 'react-native';\nimport {\n\tshowUserSuggestions,\n\tshowXpostSuggestions,\n} from '@wordpress/react-native-bridge';\nimport { get, pickBy, debounce, isString } from 'lodash';\nimport memize from 'memize';\n\n/**\n * WordPress dependencies\n */\nimport { BlockFormatControls } from '@wordpress/block-editor';\nimport { Component } from '@wordpress/element';\nimport { compose, withPreferredColorScheme } from '@wordpress/compose';\nimport { withSelect } from '@wordpress/data';\nimport { childrenBlock } from '@wordpress/blocks';\nimport { decodeEntities } from '@wordpress/html-entities';\nimport { BACKSPACE, DELETE, ENTER } from '@wordpress/keycodes';\nimport { isURL } from '@wordpress/url';\nimport { atSymbol, plus } from '@wordpress/icons';\nimport { __ } from '@wordpress/i18n';\n\n/**\n * Internal dependencies\n */\nimport { useFormatTypes } from './use-format-types';\nimport FormatEdit from './format-edit';\nimport { applyFormat } from '../apply-format';\nimport { getActiveFormat } from '../get-active-format';\nimport { getActiveFormats } from '../get-active-formats';\nimport { insert } from '../insert';\nimport { getTextContent } from '../get-text-content';\nimport { isEmpty, isEmptyLine } from '../is-empty';\nimport { create } from '../create';\nimport { toHTMLString } from '../to-html-string';\nimport { removeLineSeparator } from '../remove-line-separator';\nimport { isCollapsed } from '../is-collapsed';\nimport { remove } from '../remove';\nimport styles from './style.scss';\nimport ToolbarButtonWithOptions from './toolbar-button-with-options';\n\nconst unescapeSpaces = ( text ) => {\n\treturn text.replace( /&nbsp;|&#160;/gi, ' ' );\n};\n\nconst gutenbergFormatNamesToAztec = {\n\t'core/bold': 'bold',\n\t'core/italic': 'italic',\n\t'core/strikethrough': 'strikethrough',\n};\n\nconst EMPTY_PARAGRAPH_TAGS = '<p></p>';\n\nexport class RichText extends Component {\n\tconstructor( {\n\t\tvalue,\n\t\tselectionStart,\n\t\tselectionEnd,\n\t\t__unstableMultilineTag: multiline,\n\t} ) {\n\t\tsuper( ...arguments );\n\n\t\tthis.isMultiline = false;\n\t\tif ( multiline === true || multiline === 'p' || multiline === 'li' ) {\n\t\t\tthis.multilineTag = multiline === true ? 'p' : multiline;\n\t\t\tthis.isMultiline = true;\n\t\t}\n\n\t\tif ( this.multilineTag === 'li' ) {\n\t\t\tthis.multilineWrapperTags = [ 'ul', 'ol' ];\n\t\t}\n\n\t\tthis.isIOS = Platform.OS === 'ios';\n\t\tthis.createRecord = this.createRecord.bind( this );\n\t\tthis.restoreParagraphTags = this.restoreParagraphTags.bind( this );\n\t\tthis.onChangeFromAztec = this.onChangeFromAztec.bind( this );\n\t\tthis.onKeyDown = this.onKeyDown.bind( this );\n\t\tthis.handleEnter = this.handleEnter.bind( this );\n\t\tthis.handleDelete = this.handleDelete.bind( this );\n\t\tthis.onPaste = this.onPaste.bind( this );\n\t\tthis.onFocus = this.onFocus.bind( this );\n\t\tthis.onBlur = this.onBlur.bind( this );\n\t\tthis.onTextUpdate = this.onTextUpdate.bind( this );\n\t\tthis.onContentSizeChange = this.onContentSizeChange.bind( this );\n\t\tthis.onFormatChange = this.onFormatChange.bind( this );\n\t\tthis.formatToValue = memize( this.formatToValue.bind( this ), {\n\t\t\tmaxSize: 1,\n\t\t} );\n\t\tthis.debounceCreateUndoLevel = debounce( this.onCreateUndoLevel, 1000 );\n\t\t// This prevents a bug in Aztec which triggers onSelectionChange twice on format change\n\t\tthis.onSelectionChange = this.onSelectionChange.bind( this );\n\t\tthis.onSelectionChangeFromAztec = this.onSelectionChangeFromAztec.bind(\n\t\t\tthis\n\t\t);\n\t\tthis.valueToFormat = this.valueToFormat.bind( this );\n\t\tthis.getHtmlToRender = this.getHtmlToRender.bind( this );\n\t\tthis.handleSuggestionFunc = this.handleSuggestionFunc.bind( this );\n\t\tthis.handleUserSuggestion = this.handleSuggestionFunc(\n\t\t\tshowUserSuggestions,\n\t\t\t'@'\n\t\t).bind( this );\n\t\tthis.handleXpostSuggestion = this.handleSuggestionFunc(\n\t\t\tshowXpostSuggestions,\n\t\t\t'+'\n\t\t).bind( this );\n\t\tthis.suggestionOptions = this.suggestionOptions.bind( this );\n\t\tthis.insertString = this.insertString.bind( this );\n\t\tthis.convertFontSizeFromString = this.convertFontSizeFromString.bind(\n\t\t\tthis\n\t\t);\n\t\tthis.state = {\n\t\t\tactiveFormats: [],\n\t\t\tselectedFormat: null,\n\t\t\theight: 0,\n\t\t};\n\t\tthis.needsSelectionUpdate = false;\n\t\tthis.savedContent = '';\n\t\tthis.isTouched = false;\n\t\tthis.lastAztecEventType = null;\n\n\t\tthis.lastHistoryValue = value;\n\n\t\t// Internal values that are update synchronously, unlike props.\n\t\tthis.value = value;\n\t\tthis.selectionStart = selectionStart;\n\t\tthis.selectionEnd = selectionEnd;\n\t}\n\n\t/**\n\t * Get the current record (value and selection) from props and state.\n\t *\n\t * @return {Object} The current record (value and selection).\n\t */\n\tgetRecord() {\n\t\tconst { selectionStart: start, selectionEnd: end } = this.props;\n\t\tconst { value } = this.props;\n\n\t\tconst { formats, replacements, text } = this.formatToValue( value );\n\t\tconst { activeFormats } = this.state;\n\n\t\treturn { formats, replacements, text, start, end, activeFormats };\n\t}\n\n\t/**\n\t * Creates a RichText value \"record\" from the current content and selection\n\t * information\n\t *\n\t *\n\t * @return {Object} A RichText value with formats and selection.\n\t */\n\tcreateRecord() {\n\t\tconst { preserveWhiteSpace } = this.props;\n\t\tconst value = {\n\t\t\tstart: this.selectionStart,\n\t\t\tend: this.selectionEnd,\n\t\t\t...create( {\n\t\t\t\thtml: this.value,\n\t\t\t\trange: null,\n\t\t\t\tmultilineTag: this.multilineTag,\n\t\t\t\tmultilineWrapperTags: this.multilineWrapperTags,\n\t\t\t\tpreserveWhiteSpace,\n\t\t\t} ),\n\t\t};\n\t\tconst start = Math.min( this.selectionStart, value.text.length );\n\t\tconst end = Math.min( this.selectionEnd, value.text.length );\n\t\treturn { ...value, start, end };\n\t}\n\n\tvalueToFormat( value ) {\n\t\t// remove the outer root tags\n\t\treturn this.removeRootTagsProduceByAztec(\n\t\t\ttoHTMLString( {\n\t\t\t\tvalue,\n\t\t\t\tmultilineTag: this.multilineTag,\n\t\t\t} )\n\t\t);\n\t}\n\n\tgetActiveFormatNames( record ) {\n\t\tconst { formatTypes } = this.props;\n\n\t\treturn formatTypes\n\t\t\t.map( ( { name } ) => name )\n\t\t\t.filter( ( name ) => {\n\t\t\t\treturn getActiveFormat( record, name ) !== undefined;\n\t\t\t} )\n\t\t\t.map( ( name ) => gutenbergFormatNamesToAztec[ name ] )\n\t\t\t.filter( Boolean );\n\t}\n\n\tonFormatChange( record ) {\n\t\tconst { start = 0, end = 0, activeFormats = [] } = record;\n\t\tconst changeHandlers = pickBy( this.props, ( v, key ) =>\n\t\t\tkey.startsWith( 'format_on_change_functions_' )\n\t\t);\n\n\t\tObject.values( changeHandlers ).forEach( ( changeHandler ) => {\n\t\t\tchangeHandler( record.formats, record.text );\n\t\t} );\n\n\t\tthis.value = this.valueToFormat( record );\n\t\tthis.props.onChange( this.value );\n\t\tthis.setState( { activeFormats } );\n\t\tthis.props.onSelectionChange( start, end );\n\t\tthis.selectionStart = start;\n\t\tthis.selectionEnd = end;\n\n\t\tthis.onCreateUndoLevel();\n\n\t\tthis.lastAztecEventType = 'format change';\n\t}\n\n\tinsertString( record, string ) {\n\t\tif ( record && string ) {\n\t\t\tthis.lastEventCount = undefined;\n\t\t\tconst toInsert = insert( record, string );\n\t\t\tthis.onFormatChange( toInsert );\n\t\t}\n\t}\n\n\tonCreateUndoLevel() {\n\t\tconst { __unstableOnCreateUndoLevel: onCreateUndoLevel } = this.props;\n\t\t// If the content is the same, no level needs to be created.\n\t\tif ( this.lastHistoryValue === this.value ) {\n\t\t\treturn;\n\t\t}\n\n\t\tonCreateUndoLevel();\n\t\tthis.lastHistoryValue = this.value;\n\t}\n\n\t/*\n\t * Cleans up any root tags produced by aztec.\n\t * TODO: This should be removed on a later version when aztec doesn't return the top tag of the text being edited\n\t */\n\tremoveRootTagsProduceByAztec( html ) {\n\t\tlet result = this.removeRootTag( this.props.tagName, html );\n\t\t// Temporary workaround for https://github.com/WordPress/gutenberg/pull/13763\n\t\tif ( this.props.rootTagsToEliminate ) {\n\t\t\tthis.props.rootTagsToEliminate.forEach( ( element ) => {\n\t\t\t\tresult = this.removeRootTag( element, result );\n\t\t\t} );\n\t\t}\n\n\t\tif ( this.props.tagsToEliminate ) {\n\t\t\tthis.props.tagsToEliminate.forEach( ( element ) => {\n\t\t\t\tresult = this.removeTag( element, result );\n\t\t\t} );\n\t\t}\n\t\treturn result;\n\t}\n\n\tremoveRootTag( tag, html ) {\n\t\tconst openingTagRegexp = RegExp( '^<' + tag + '[^>]*>', 'gim' );\n\t\tconst closingTagRegexp = RegExp( '</' + tag + '>$', 'gim' );\n\t\treturn html\n\t\t\t.replace( openingTagRegexp, '' )\n\t\t\t.replace( closingTagRegexp, '' );\n\t}\n\tremoveTag( tag, html ) {\n\t\tconst openingTagRegexp = RegExp( '<' + tag + '>', 'gim' );\n\t\tconst closingTagRegexp = RegExp( '</' + tag + '>', 'gim' );\n\t\treturn html\n\t\t\t.replace( openingTagRegexp, '' )\n\t\t\t.replace( closingTagRegexp, '' );\n\t}\n\n\t// Fix for crash https://github.com/wordpress-mobile/gutenberg-mobile/issues/2991\n\tconvertFontSizeFromString( fontSize ) {\n\t\treturn fontSize && isString( fontSize ) && fontSize.endsWith( 'px' )\n\t\t\t? parseFloat( fontSize.substring( 0, fontSize.length - 2 ) )\n\t\t\t: fontSize;\n\t}\n\n\t/*\n\t * Handles any case where the content of the AztecRN instance has changed\n\t */\n\tonChangeFromAztec( event ) {\n\t\tconst contentWithoutRootTag = this.removeRootTagsProduceByAztec(\n\t\t\tunescapeSpaces( event.nativeEvent.text )\n\t\t);\n\t\t// On iOS, onChange can be triggered after selection changes, even though there are no content changes.\n\t\tif ( contentWithoutRootTag === this.value ) {\n\t\t\treturn;\n\t\t}\n\t\tthis.lastEventCount = event.nativeEvent.eventCount;\n\t\tthis.comesFromAztec = true;\n\t\tthis.firedAfterTextChanged = true; // the onChange event always fires after the fact\n\t\tthis.onTextUpdate( event );\n\t\tthis.lastAztecEventType = 'input';\n\t}\n\n\tonTextUpdate( event ) {\n\t\tconst contentWithoutRootTag = this.removeRootTagsProduceByAztec(\n\t\t\tunescapeSpaces( event.nativeEvent.text )\n\t\t);\n\t\tlet formattedContent = contentWithoutRootTag;\n\t\tif ( ! this.isIOS ) {\n\t\t\tformattedContent = this.restoreParagraphTags(\n\t\t\t\tcontentWithoutRootTag,\n\t\t\t\tthis.multilineTag\n\t\t\t);\n\t\t}\n\n\t\tthis.debounceCreateUndoLevel();\n\t\tconst refresh = this.value !== formattedContent;\n\t\tthis.value = formattedContent;\n\n\t\t// we don't want to refresh if our goal is just to create a record\n\t\tif ( refresh ) {\n\t\t\tthis.props.onChange( formattedContent );\n\t\t}\n\t}\n\n\trestoreParagraphTags( value, tag ) {\n\t\tif ( tag === 'p' && ( ! value || ! value.startsWith( '<p>' ) ) ) {\n\t\t\treturn '<p>' + value + '</p>';\n\t\t}\n\t\treturn value;\n\t}\n\n\t/*\n\t * Handles any case where the content of the AztecRN instance has changed in size\n\t */\n\tonContentSizeChange( contentSize ) {\n\t\tthis.setState( contentSize );\n\t\tthis.lastAztecEventType = 'content size change';\n\t}\n\n\tonKeyDown( event ) {\n\t\tif ( event.defaultPrevented ) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.handleDelete( event );\n\t\tthis.handleEnter( event );\n\t\tthis.handleTriggerKeyCodes( event );\n\t}\n\n\thandleEnter( event ) {\n\t\tif ( event.keyCode !== ENTER ) {\n\t\t\treturn;\n\t\t}\n\t\tconst { onEnter } = this.props;\n\n\t\tif ( ! onEnter ) {\n\t\t\treturn;\n\t\t}\n\n\t\tonEnter( {\n\t\t\tvalue: this.createRecord(),\n\t\t\tonChange: this.onFormatChange,\n\t\t\tshiftKey: event.shiftKey,\n\t\t} );\n\t\tthis.lastAztecEventType = 'input';\n\t}\n\n\thandleDelete( event ) {\n\t\tconst { keyCode } = event;\n\n\t\tif ( keyCode !== DELETE && keyCode !== BACKSPACE ) {\n\t\t\treturn;\n\t\t}\n\t\tconst isReverse = keyCode === BACKSPACE;\n\n\t\tconst { onDelete, __unstableMultilineTag: multilineTag } = this.props;\n\t\tthis.lastEventCount = event.nativeEvent.eventCount;\n\t\tthis.comesFromAztec = true;\n\t\tthis.firedAfterTextChanged = event.nativeEvent.firedAfterTextChanged;\n\t\tconst value = this.createRecord();\n\t\tconst { start, end, text } = value;\n\t\tlet newValue;\n\n\t\t// Always handle full content deletion ourselves.\n\t\tif ( start === 0 && end !== 0 && end >= text.length ) {\n\t\t\tnewValue = remove( value );\n\t\t\tthis.onFormatChange( newValue );\n\t\t\tevent.preventDefault();\n\t\t\treturn;\n\t\t}\n\n\t\tif ( multilineTag ) {\n\t\t\tif (\n\t\t\t\tisReverse &&\n\t\t\t\tvalue.start === 0 &&\n\t\t\t\tvalue.end === 0 &&\n\t\t\t\tisEmptyLine( value )\n\t\t\t) {\n\t\t\t\tnewValue = removeLineSeparator( value, ! isReverse );\n\t\t\t} else {\n\t\t\t\tnewValue = removeLineSeparator( value, isReverse );\n\t\t\t}\n\t\t\tif ( newValue ) {\n\t\t\t\tthis.onFormatChange( newValue );\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// Only process delete if the key press occurs at an uncollapsed edge.\n\t\tif (\n\t\t\t! onDelete ||\n\t\t\t! isCollapsed( value ) ||\n\t\t\t( isReverse && start !== 0 ) ||\n\t\t\t( ! isReverse && end !== text.length )\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tonDelete( { isReverse, value } );\n\n\t\tevent.preventDefault();\n\t\tthis.lastAztecEventType = 'input';\n\t}\n\n\thandleTriggerKeyCodes( event ) {\n\t\tconst { keyCode } = event;\n\t\tconst triggeredOption = this.suggestionOptions().find( ( option ) => {\n\t\t\tconst triggeredKeyCode = option.triggerChar.charCodeAt( 0 );\n\t\t\treturn triggeredKeyCode === keyCode;\n\t\t} );\n\n\t\tif ( triggeredOption ) {\n\t\t\tconst record = this.getRecord();\n\t\t\tconst text = getTextContent( record );\n\t\t\t// Only respond to the trigger if the selection is on the start of text or line\n\t\t\t// or if the character before is a space\n\t\t\tconst useTrigger =\n\t\t\t\ttext.length === 0 ||\n\t\t\t\trecord.start === 0 ||\n\t\t\t\ttext.charAt( record.start - 1 ) === '\\n' ||\n\t\t\t\ttext.charAt( record.start - 1 ) === ' ';\n\n\t\t\tif ( useTrigger && triggeredOption.onClick ) {\n\t\t\t\ttriggeredOption.onClick();\n\t\t\t} else {\n\t\t\t\tthis.insertString( record, triggeredOption.triggerChar );\n\t\t\t}\n\t\t}\n\t}\n\n\tsuggestionOptions() {\n\t\tconst { areMentionsSupported, areXPostsSupported } = this.props;\n\t\tconst allOptions = [\n\t\t\t{\n\t\t\t\tsupported: areMentionsSupported,\n\t\t\t\ttitle: __( 'Insert mention' ),\n\t\t\t\tonClick: this.handleUserSuggestion,\n\t\t\t\ttriggerChar: '@',\n\t\t\t\tvalue: 'mention',\n\t\t\t\tlabel: __( 'Mention' ),\n\t\t\t\ticon: atSymbol,\n\t\t\t},\n\t\t\t{\n\t\t\t\tsupported: areXPostsSupported,\n\t\t\t\ttitle: __( 'Insert crosspost' ),\n\t\t\t\tonClick: this.handleXpostSuggestion,\n\t\t\t\ttriggerChar: '+',\n\t\t\t\tvalue: 'crosspost',\n\t\t\t\tlabel: __( 'Crosspost' ),\n\t\t\t\ticon: plus,\n\t\t\t},\n\t\t];\n\t\treturn allOptions.filter( ( op ) => op.supported );\n\t}\n\n\thandleSuggestionFunc( suggestionFunction, prefix ) {\n\t\treturn () => {\n\t\t\tconst record = this.getRecord();\n\t\t\tsuggestionFunction()\n\t\t\t\t.then( ( suggestion ) => {\n\t\t\t\t\tthis.insertString( record, `${ prefix }${ suggestion } ` );\n\t\t\t\t} )\n\t\t\t\t.catch( () => {} );\n\t\t};\n\t}\n\n\t/**\n\t * Handles a paste event from the native Aztec Wrapper.\n\t *\n\t * @param {Object} event The paste event which wraps `nativeEvent`.\n\t */\n\tonPaste( event ) {\n\t\tconst { onPaste, onChange } = this.props;\n\t\tconst { activeFormats = [] } = this.state;\n\n\t\tconst { pastedText, pastedHtml, files } = event.nativeEvent;\n\t\tconst currentRecord = this.createRecord();\n\n\t\tevent.preventDefault();\n\n\t\t// There is a selection, check if a URL is pasted.\n\t\tif ( ! isCollapsed( currentRecord ) ) {\n\t\t\tconst trimmedText = ( pastedHtml || pastedText )\n\t\t\t\t.replace( /<[^>]+>/g, '' )\n\t\t\t\t.trim();\n\n\t\t\t// A URL was pasted, turn the selection into a link\n\t\t\tif ( isURL( trimmedText ) ) {\n\t\t\t\tconst linkedRecord = applyFormat( currentRecord, {\n\t\t\t\t\ttype: 'a',\n\t\t\t\t\tattributes: {\n\t\t\t\t\t\thref: decodeEntities( trimmedText ),\n\t\t\t\t\t},\n\t\t\t\t} );\n\t\t\t\tthis.value = this.valueToFormat( linkedRecord );\n\t\t\t\tonChange( this.value );\n\n\t\t\t\t// Allows us to ask for this information when we get a report.\n\t\t\t\twindow.console.log( 'Created link:\\n\\n', trimmedText );\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif ( onPaste ) {\n\t\t\tonPaste( {\n\t\t\t\tvalue: currentRecord,\n\t\t\t\tonChange: this.onFormatChange,\n\t\t\t\thtml: pastedHtml,\n\t\t\t\tplainText: pastedText,\n\t\t\t\tfiles,\n\t\t\t\tactiveFormats,\n\t\t\t} );\n\t\t}\n\t}\n\n\tonFocus() {\n\t\tthis.isTouched = true;\n\n\t\tconst { unstableOnFocus, onSelectionChange } = this.props;\n\n\t\tif ( unstableOnFocus ) {\n\t\t\tunstableOnFocus();\n\t\t}\n\n\t\t// We know for certain that on focus, the old selection is invalid. It\n\t\t// will be recalculated on `selectionchange`.\n\n\t\tonSelectionChange( this.selectionStart, this.selectionEnd );\n\n\t\tthis.lastAztecEventType = 'focus';\n\t}\n\n\tonBlur( event ) {\n\t\tthis.isTouched = false;\n\n\t\t// Check if value is up to date with latest state of native AztecView\n\t\tif (\n\t\t\tevent.nativeEvent.text &&\n\t\t\tevent.nativeEvent.text !== this.props.value\n\t\t) {\n\t\t\tthis.onTextUpdate( event );\n\t\t}\n\n\t\tif ( this.props.onBlur ) {\n\t\t\tthis.props.onBlur( event );\n\t\t}\n\n\t\tthis.lastAztecEventType = 'blur';\n\t}\n\n\tonSelectionChange( start, end ) {\n\t\tconst hasChanged =\n\t\t\tthis.selectionStart !== start || this.selectionEnd !== end;\n\n\t\tthis.selectionStart = start;\n\t\tthis.selectionEnd = end;\n\n\t\t// This is a manual selection change event if onChange was not triggered just before\n\t\t// and we did not just trigger a text update\n\t\t// `onChange` could be the last event and could have been triggered a long time ago so\n\t\t// this approach is not perfectly reliable\n\t\tconst isManual =\n\t\t\tthis.lastAztecEventType !== 'input' &&\n\t\t\tthis.props.value === this.value;\n\t\tif ( hasChanged && isManual ) {\n\t\t\tconst value = this.createRecord();\n\t\t\tconst activeFormats = getActiveFormats( value );\n\t\t\tthis.setState( { activeFormats } );\n\t\t}\n\n\t\tthis.props.onSelectionChange( start, end );\n\t}\n\n\tonSelectionChangeFromAztec( start, end, text, event ) {\n\t\t// `end` can be less than `start` on iOS\n\t\t// Let's fix that here so `rich-text/slice` can work properly\n\t\tconst realStart = Math.min( start, end );\n\t\tconst realEnd = Math.max( start, end );\n\n\t\t// check and dicsard stray event, where the text and selection is equal to the ones already cached\n\t\tconst contentWithoutRootTag = this.removeRootTagsProduceByAztec(\n\t\t\tunescapeSpaces( event.nativeEvent.text )\n\t\t);\n\t\tif (\n\t\t\tcontentWithoutRootTag === this.value &&\n\t\t\trealStart === this.selectionStart &&\n\t\t\trealEnd === this.selectionEnd\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.comesFromAztec = true;\n\t\tthis.firedAfterTextChanged = true; // Selection change event always fires after the fact\n\n\t\t// update text before updating selection\n\t\t// Make sure there are changes made to the content before upgrading it upward\n\t\tthis.onTextUpdate( event );\n\n\t\t// Aztec can send us selection change events after it has lost focus.\n\t\t// For instance the autocorrect feature will complete a partially written\n\t\t// word when resigning focus, causing a selection change event.\n\t\t// Forwarding this selection change could cause this RichText to regain\n\t\t// focus and start a focus loop.\n\t\t//\n\t\t// See https://github.com/wordpress-mobile/gutenberg-mobile/issues/1696\n\t\tif ( this.props.__unstableIsSelected ) {\n\t\t\tthis.onSelectionChange( realStart, realEnd );\n\t\t}\n\t\t// Update lastEventCount to prevent Aztec from re-rendering the content it just sent\n\t\tthis.lastEventCount = event.nativeEvent.eventCount;\n\n\t\tthis.lastAztecEventType = 'selection change';\n\t}\n\n\tisEmpty() {\n\t\treturn isEmpty( this.formatToValue( this.props.value ) );\n\t}\n\n\tformatToValue( value ) {\n\t\tconst { preserveWhiteSpace } = this.props;\n\t\t// Handle deprecated `children` and `node` sources.\n\t\tif ( Array.isArray( value ) ) {\n\t\t\treturn create( {\n\t\t\t\thtml: childrenBlock.toHTML( value ),\n\t\t\t\tmultilineTag: this.multilineTag,\n\t\t\t\tmultilineWrapperTags: this.multilineWrapperTags,\n\t\t\t\tpreserveWhiteSpace,\n\t\t\t} );\n\t\t}\n\n\t\tif ( this.props.format === 'string' ) {\n\t\t\treturn create( {\n\t\t\t\thtml: value,\n\t\t\t\tmultilineTag: this.multilineTag,\n\t\t\t\tmultilineWrapperTags: this.multilineWrapperTags,\n\t\t\t\tpreserveWhiteSpace,\n\t\t\t} );\n\t\t}\n\n\t\t// Guard for blocks passing `null` in onSplit callbacks. May be removed\n\t\t// if onSplit is revised to not pass a `null` value.\n\t\tif ( value === null ) {\n\t\t\treturn create();\n\t\t}\n\n\t\treturn value;\n\t}\n\n\tshouldComponentUpdate( nextProps ) {\n\t\tif (\n\t\t\tnextProps.tagName !== this.props.tagName ||\n\t\t\tnextProps.reversed !== this.props.reversed ||\n\t\t\tnextProps.start !== this.props.start\n\t\t) {\n\t\t\tthis.lastEventCount = undefined;\n\t\t\tthis.value = undefined;\n\t\t\treturn true;\n\t\t}\n\n\t\t// TODO: Please re-introduce the check to avoid updating the content right after an `onChange` call.\n\t\t// It was removed in https://github.com/WordPress/gutenberg/pull/12417 to fix undo/redo problem.\n\n\t\t// If the component is changed React side (undo/redo/merging/splitting/custom text actions)\n\t\t// we need to make sure the native is updated as well.\n\n\t\t// Also, don't trust the \"this.lastContent\" as on Android, incomplete text events arrive\n\t\t//  with only some of the text, while the virtual keyboard's suggestion system does its magic.\n\t\t// ** compare with this.lastContent for optimizing performance by not forcing Aztec with text it already has\n\t\t// , but compare with props.value to not lose \"half word\" text because of Android virtual keyb autosuggestion behavior\n\t\tif (\n\t\t\ttypeof nextProps.value !== 'undefined' &&\n\t\t\ttypeof this.props.value !== 'undefined' &&\n\t\t\t( ! this.comesFromAztec || ! this.firedAfterTextChanged ) &&\n\t\t\tnextProps.value !== this.props.value\n\t\t) {\n\t\t\t// Gutenberg seems to try to mirror the caret state even on events that only change the content so,\n\t\t\t//  let's force caret update if state has selection set.\n\t\t\tif (\n\t\t\t\ttypeof nextProps.selectionStart !== 'undefined' &&\n\t\t\t\ttypeof nextProps.selectionEnd !== 'undefined'\n\t\t\t) {\n\t\t\t\tthis.needsSelectionUpdate = true;\n\t\t\t}\n\n\t\t\tthis.lastEventCount = undefined; // force a refresh on the native side\n\t\t}\n\n\t\tif ( ! this.comesFromAztec ) {\n\t\t\tif (\n\t\t\t\ttypeof nextProps.selectionStart !== 'undefined' &&\n\t\t\t\ttypeof nextProps.selectionEnd !== 'undefined' &&\n\t\t\t\tnextProps.selectionStart !== this.props.selectionStart &&\n\t\t\t\tnextProps.selectionStart !== this.selectionStart &&\n\t\t\t\tnextProps.__unstableIsSelected\n\t\t\t) {\n\t\t\t\tthis.needsSelectionUpdate = true;\n\t\t\t\tthis.lastEventCount = undefined; // force a refresh on the native side\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tcomponentDidMount() {\n\t\t// Request focus if wrapping block is selected and parent hasn't inhibited the focus request. This method of focusing\n\t\t//  is trying to implement the web-side counterpart of BlockList's `focusTabbable` where the BlockList is focusing an\n\t\t//  inputbox by searching the DOM. We don't have the DOM in RN so, using the combination of blockIsSelected and __unstableMobileNoFocusOnMount\n\t\t//  to determine if we should focus the RichText.\n\t\tif (\n\t\t\tthis.props.blockIsSelected &&\n\t\t\t! this.props.__unstableMobileNoFocusOnMount\n\t\t) {\n\t\t\tthis._editor.focus();\n\t\t\tthis.onSelectionChange(\n\t\t\t\tthis.props.selectionStart || 0,\n\t\t\t\tthis.props.selectionEnd || 0\n\t\t\t);\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\tif ( this._editor.isFocused() ) {\n\t\t\tthis._editor.blur();\n\t\t}\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tif ( this.props.value !== this.value ) {\n\t\t\tthis.value = this.props.value;\n\t\t\tthis.lastEventCount = undefined;\n\t\t}\n\t\tconst { __unstableIsSelected: isSelected } = this.props;\n\n\t\tconst { __unstableIsSelected: prevIsSelected } = prevProps;\n\n\t\tif ( isSelected && ! prevIsSelected ) {\n\t\t\tthis._editor.focus();\n\t\t\t// Update selection props explicitly when component is selected as Aztec won't call onSelectionChange\n\t\t\t// if its internal value hasn't change. When created, default value is 0, 0\n\t\t\tthis.onSelectionChange(\n\t\t\t\tthis.props.selectionStart || 0,\n\t\t\t\tthis.props.selectionEnd || 0\n\t\t\t);\n\t\t} else if ( ! isSelected && prevIsSelected ) {\n\t\t\tthis._editor.blur();\n\t\t}\n\t}\n\n\tgetHtmlToRender( record, tagName ) {\n\t\t// Save back to HTML from React tree\n\t\tlet value = this.valueToFormat( record );\n\n\t\tif ( value === undefined ) {\n\t\t\tthis.lastEventCount = undefined; // force a refresh on the native side\n\t\t\tvalue = '';\n\t\t}\n\t\t// On android if content is empty we need to send no content or else the placeholder will not show.\n\t\tif (\n\t\t\t! this.isIOS &&\n\t\t\t( value === '' || value === EMPTY_PARAGRAPH_TAGS )\n\t\t) {\n\t\t\treturn '';\n\t\t}\n\n\t\tif ( tagName ) {\n\t\t\tlet extraAttributes = ``;\n\t\t\tif ( tagName === `ol` ) {\n\t\t\t\tif ( this.props.reversed ) {\n\t\t\t\t\textraAttributes += ` reversed`;\n\t\t\t\t}\n\t\t\t\tif ( this.props.start ) {\n\t\t\t\t\textraAttributes += ` start=${ this.props.start }`;\n\t\t\t\t}\n\t\t\t}\n\t\t\tvalue = `<${ tagName } ${ extraAttributes }>${ value }</${ tagName }>`;\n\t\t}\n\t\treturn value;\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\ttagName,\n\t\t\tstyle,\n\t\t\t__unstableIsSelected: isSelected,\n\t\t\tchildren,\n\t\t\tgetStylesFromColorScheme,\n\t\t\tminWidth,\n\t\t\tmaxWidth,\n\t\t\tformatTypes,\n\t\t\tparentBlockStyles,\n\t\t\taccessibilityLabel,\n\t\t\tdisableEditingMenu = false,\n\t\t} = this.props;\n\n\t\tconst record = this.getRecord();\n\t\tconst html = this.getHtmlToRender( record, tagName );\n\n\t\tconst placeholderStyle = getStylesFromColorScheme(\n\t\t\tstyles.richTextPlaceholder,\n\t\t\tstyles.richTextPlaceholderDark\n\t\t);\n\n\t\tconst { color: defaultPlaceholderTextColor } = placeholderStyle;\n\n\t\tconst {\n\t\t\tcolor: defaultColor,\n\t\t\ttextDecorationColor: defaultTextDecorationColor,\n\t\t\tfontFamily: defaultFontFamily,\n\t\t} = getStylesFromColorScheme( styles.richText, styles.richTextDark );\n\n\t\tlet selection = null;\n\t\tif ( this.needsSelectionUpdate ) {\n\t\t\tthis.needsSelectionUpdate = false;\n\t\t\tselection = {\n\t\t\t\tstart: this.props.selectionStart,\n\t\t\t\tend: this.props.selectionEnd,\n\t\t\t};\n\n\t\t\t// On AztecAndroid, setting the caret to an out-of-bounds position will crash the editor so, let's check for some cases.\n\t\t\tif ( ! this.isIOS ) {\n\t\t\t\t// The following regular expression is used in Aztec here:\n\t\t\t\t// https://github.com/wordpress-mobile/AztecEditor-Android/blob/b1fad439d56fa6d4aa0b78526fef355c59d00dd3/aztec/src/main/kotlin/org/wordpress/aztec/AztecParser.kt#L656\n\t\t\t\tconst brBeforeParaMatches = html.match( /(<br>)+<\\/p>$/g );\n\t\t\t\tif ( brBeforeParaMatches ) {\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t'Oops, BR tag(s) at the end of content. Aztec will remove them, adapting the selection...'\n\t\t\t\t\t);\n\t\t\t\t\tconst count = (\n\t\t\t\t\t\tbrBeforeParaMatches[ 0 ].match( /br/g ) || []\n\t\t\t\t\t).length;\n\t\t\t\t\tif ( count > 0 ) {\n\t\t\t\t\t\tlet newSelectionStart =\n\t\t\t\t\t\t\tthis.props.selectionStart - count;\n\t\t\t\t\t\tif ( newSelectionStart < 0 ) {\n\t\t\t\t\t\t\tnewSelectionStart = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlet newSelectionEnd = this.props.selectionEnd - count;\n\t\t\t\t\t\tif ( newSelectionEnd < 0 ) {\n\t\t\t\t\t\t\tnewSelectionEnd = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tselection = {\n\t\t\t\t\t\t\tstart: newSelectionStart,\n\t\t\t\t\t\t\tend: newSelectionEnd,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( this.comesFromAztec ) {\n\t\t\tthis.comesFromAztec = false;\n\t\t\tthis.firedAfterTextChanged = false;\n\t\t}\n\n\t\t// Logic below assures that `RichText` width will always have equal value when container is almost fully filled.\n\t\tconst width =\n\t\t\tmaxWidth && this.state.width && maxWidth - this.state.width < 10\n\t\t\t\t? maxWidth\n\t\t\t\t: this.state.width;\n\t\tconst containerStyles = style?.padding &&\n\t\t\tstyle?.backgroundColor && {\n\t\t\t\tpadding: style.padding,\n\t\t\t\tbackgroundColor: style.backgroundColor,\n\t\t\t};\n\n\t\treturn (\n\t\t\t<View style={ containerStyles }>\n\t\t\t\t{ children &&\n\t\t\t\t\tchildren( {\n\t\t\t\t\t\tisSelected,\n\t\t\t\t\t\tvalue: record,\n\t\t\t\t\t\tonChange: this.onFormatChange,\n\t\t\t\t\t\tonFocus: () => {},\n\t\t\t\t\t} ) }\n\t\t\t\t<RCTAztecView\n\t\t\t\t\taccessibilityLabel={ accessibilityLabel }\n\t\t\t\t\tref={ ( ref ) => {\n\t\t\t\t\t\tthis._editor = ref;\n\n\t\t\t\t\t\tif ( this.props.setRef ) {\n\t\t\t\t\t\t\tthis.props.setRef( ref );\n\t\t\t\t\t\t}\n\t\t\t\t\t} }\n\t\t\t\t\tstyle={ {\n\t\t\t\t\t\tbackgroundColor: styles.richText.backgroundColor,\n\t\t\t\t\t\t...style,\n\t\t\t\t\t\t...( this.isIOS && minWidth && maxWidth\n\t\t\t\t\t\t\t? { width }\n\t\t\t\t\t\t\t: { maxWidth } ),\n\t\t\t\t\t\tminHeight: this.state.height,\n\t\t\t\t\t} }\n\t\t\t\t\ttext={ {\n\t\t\t\t\t\ttext: html,\n\t\t\t\t\t\teventCount: this.lastEventCount,\n\t\t\t\t\t\tselection,\n\t\t\t\t\t\tlinkTextColor: defaultTextDecorationColor,\n\t\t\t\t\t} }\n\t\t\t\t\tplaceholder={ this.props.placeholder }\n\t\t\t\t\tplaceholderTextColor={\n\t\t\t\t\t\tthis.props.placeholderTextColor ||\n\t\t\t\t\t\tdefaultPlaceholderTextColor\n\t\t\t\t\t}\n\t\t\t\t\tdeleteEnter={ this.props.deleteEnter }\n\t\t\t\t\tonChange={ this.onChangeFromAztec }\n\t\t\t\t\tonFocus={ this.onFocus }\n\t\t\t\t\tonBlur={ this.onBlur }\n\t\t\t\t\tonKeyDown={ this.onKeyDown }\n\t\t\t\t\ttriggerKeyCodes={ this.suggestionOptions().map(\n\t\t\t\t\t\t( op ) => op.triggerChar\n\t\t\t\t\t) }\n\t\t\t\t\tonPaste={ this.onPaste }\n\t\t\t\t\tactiveFormats={ this.getActiveFormatNames( record ) }\n\t\t\t\t\tonContentSizeChange={ this.onContentSizeChange }\n\t\t\t\t\tonCaretVerticalPositionChange={\n\t\t\t\t\t\tthis.props.onCaretVerticalPositionChange\n\t\t\t\t\t}\n\t\t\t\t\tonSelectionChange={ this.onSelectionChangeFromAztec }\n\t\t\t\t\tblockType={ { tag: tagName } }\n\t\t\t\t\tcolor={\n\t\t\t\t\t\t( style && style.color ) ||\n\t\t\t\t\t\t( parentBlockStyles && parentBlockStyles.color ) ||\n\t\t\t\t\t\tdefaultColor\n\t\t\t\t\t}\n\t\t\t\t\tmaxImagesWidth={ 200 }\n\t\t\t\t\tfontFamily={ this.props.fontFamily || defaultFontFamily }\n\t\t\t\t\tfontSize={\n\t\t\t\t\t\tthis.props.fontSize ||\n\t\t\t\t\t\t( style &&\n\t\t\t\t\t\t\tthis.convertFontSizeFromString( style.fontSize ) )\n\t\t\t\t\t}\n\t\t\t\t\tfontWeight={ this.props.fontWeight }\n\t\t\t\t\tfontStyle={ this.props.fontStyle }\n\t\t\t\t\tdisableEditingMenu={ disableEditingMenu }\n\t\t\t\t\tisMultiline={ this.isMultiline }\n\t\t\t\t\ttextAlign={ this.props.textAlign }\n\t\t\t\t\t{ ...( this.isIOS ? { maxWidth } : {} ) }\n\t\t\t\t\tminWidth={ minWidth }\n\t\t\t\t\tid={ this.props.id }\n\t\t\t\t\tselectionColor={ this.props.selectionColor }\n\t\t\t\t/>\n\t\t\t\t{ isSelected && (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<FormatEdit\n\t\t\t\t\t\t\tformatTypes={ formatTypes }\n\t\t\t\t\t\t\tvalue={ record }\n\t\t\t\t\t\t\tonChange={ this.onFormatChange }\n\t\t\t\t\t\t\tonFocus={ () => {} }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<BlockFormatControls>\n\t\t\t\t\t\t\t<ToolbarButtonWithOptions\n\t\t\t\t\t\t\t\toptions={ this.suggestionOptions() }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</BlockFormatControls>\n\t\t\t\t\t</>\n\t\t\t\t) }\n\t\t\t</View>\n\t\t);\n\t}\n}\n\nRichText.defaultProps = {\n\tformat: 'string',\n\tvalue: '',\n\ttagName: 'div',\n};\n\nconst withFormatTypes = ( WrappedComponent ) => ( props ) => {\n\tconst { formatTypes } = useFormatTypes( {\n\t\tclientId: props.clientId,\n\t\tidentifier: props.identifier,\n\t\twithoutInteractiveFormatting: props.withoutInteractiveFormatting,\n\t} );\n\n\treturn <WrappedComponent { ...props } formatTypes={ formatTypes } />;\n};\n\nexport default compose( [\n\twithSelect( ( select, { clientId } ) => {\n\t\tconst { getBlockParents, getBlock, getSettings } = select(\n\t\t\t'core/block-editor'\n\t\t);\n\t\tconst parents = getBlockParents( clientId, true );\n\t\tconst parentBlock = parents ? getBlock( parents[ 0 ] ) : undefined;\n\t\tconst parentBlockStyles =\n\t\t\tget( parentBlock, [ 'attributes', 'childrenStyles' ] ) || {};\n\n\t\treturn {\n\t\t\tareMentionsSupported:\n\t\t\t\tgetSettings( 'capabilities' ).mentions === true,\n\t\t\tareXPostsSupported: getSettings( 'capabilities' ).xposts === true,\n\t\t\t...{ parentBlockStyles },\n\t\t};\n\t} ),\n\twithPreferredColorScheme,\n\twithFormatTypes,\n] )( RichText );\n"]}