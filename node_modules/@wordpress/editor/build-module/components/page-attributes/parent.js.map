{"version":3,"sources":["@wordpress/editor/src/components/page-attributes/parent.js"],"names":["get","unescape","unescapeString","debounce","flatMap","repeat","find","__","ComboboxControl","useState","useMemo","useSelect","useDispatch","buildTermsTree","getTitle","post","title","rendered","id","PageAttributesParent","editPost","fieldValue","setFieldValue","isSearching","select","getPostType","getEntityRecords","getEntityRecord","getCurrentPostId","getEditedPostAttribute","postTypeSlug","pageId","pType","postId","isHierarchical","query","per_page","exclude","parent_exclude","orderby","order","_fields","search","parentPostId","parentPost","items","postType","parentPageLabel","pageItems","getOptionsFromTree","tree","level","treeNode","value","label","name","children","parentOptions","map","item","parent","opts","optsHasParent","unshift","handleKeydown","inputValue","handleChange","selectedPostId"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport {\n\tget,\n\tunescape as unescapeString,\n\tdebounce,\n\tflatMap,\n\trepeat,\n\tfind,\n} from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { ComboboxControl } from '@wordpress/components';\nimport { useState, useMemo } from '@wordpress/element';\nimport { useSelect, useDispatch } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport { buildTermsTree } from '../../utils/terms';\n\nfunction getTitle( post ) {\n\treturn post?.title?.rendered\n\t\t? post.title.rendered\n\t\t: `#${ post.id } (${ __( 'no title' ) })`;\n}\n\nexport function PageAttributesParent() {\n\tconst { editPost } = useDispatch( 'core/editor' );\n\tconst [ fieldValue, setFieldValue ] = useState( false );\n\tconst isSearching = fieldValue;\n\tconst { parentPost, parentPostId, items, postType } = useSelect(\n\t\t( select ) => {\n\t\t\tconst { getPostType, getEntityRecords, getEntityRecord } = select(\n\t\t\t\t'core'\n\t\t\t);\n\t\t\tconst { getCurrentPostId, getEditedPostAttribute } = select(\n\t\t\t\t'core/editor'\n\t\t\t);\n\t\t\tconst postTypeSlug = getEditedPostAttribute( 'type' );\n\t\t\tconst pageId = getEditedPostAttribute( 'parent' );\n\t\t\tconst pType = getPostType( postTypeSlug );\n\t\t\tconst postId = getCurrentPostId();\n\t\t\tconst isHierarchical = get( pType, [ 'hierarchical' ], false );\n\t\t\tconst query = {\n\t\t\t\tper_page: 100,\n\t\t\t\texclude: postId,\n\t\t\t\tparent_exclude: postId,\n\t\t\t\torderby: 'menu_order',\n\t\t\t\torder: 'asc',\n\t\t\t\t_fields: 'id,title,parent',\n\t\t\t};\n\n\t\t\t// Perform a search when the field is changed.\n\t\t\tif ( isSearching ) {\n\t\t\t\tquery.search = fieldValue;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tparentPostId: pageId,\n\t\t\t\tparentPost: pageId\n\t\t\t\t\t? getEntityRecord( 'postType', postTypeSlug, pageId )\n\t\t\t\t\t: null,\n\t\t\t\titems: isHierarchical\n\t\t\t\t\t? getEntityRecords( 'postType', postTypeSlug, query )\n\t\t\t\t\t: [],\n\t\t\t\tpostType: pType,\n\t\t\t};\n\t\t},\n\t\t[ fieldValue ]\n\t);\n\n\tconst isHierarchical = get( postType, [ 'hierarchical' ], false );\n\tconst parentPageLabel = get( postType, [ 'labels', 'parent_item_colon' ] );\n\tconst pageItems = items || [];\n\tconst getOptionsFromTree = ( tree, level = 0 ) => {\n\t\treturn flatMap( tree, ( treeNode ) => [\n\t\t\t{\n\t\t\t\tvalue: treeNode.id,\n\t\t\t\tlabel: repeat( 'â€” ', level ) + unescapeString( treeNode.name ),\n\t\t\t},\n\t\t\t...getOptionsFromTree( treeNode.children || [], level + 1 ),\n\t\t] );\n\t};\n\n\tconst parentOptions = useMemo( () => {\n\t\tlet tree = pageItems.map( ( item ) => ( {\n\t\t\tid: item.id,\n\t\t\tparent: item.parent,\n\t\t\tname: getTitle( item ),\n\t\t} ) );\n\n\t\t// Only build a hierarchical tree when not searching.\n\t\tif ( ! isSearching ) {\n\t\t\ttree = buildTermsTree( tree );\n\t\t}\n\n\t\tconst opts = getOptionsFromTree( tree );\n\n\t\t// Ensure the current parent is in the options list.\n\t\tconst optsHasParent = find(\n\t\t\topts,\n\t\t\t( item ) => item.value === parentPostId\n\t\t);\n\t\tif ( parentPost && ! optsHasParent ) {\n\t\t\topts.unshift( {\n\t\t\t\tvalue: parentPostId,\n\t\t\t\tlabel: getTitle( parentPost ),\n\t\t\t} );\n\t\t}\n\t\treturn opts;\n\t}, [ pageItems ] );\n\n\tif ( ! isHierarchical || ! parentPageLabel ) {\n\t\treturn null;\n\t}\n\t/**\n\t * Handle user input.\n\t *\n\t * @param {string} inputValue The current value of the input field.\n\t */\n\tconst handleKeydown = ( inputValue ) => {\n\t\tsetFieldValue( inputValue );\n\t};\n\n\t/**\n\t * Handle author selection.\n\t *\n\t * @param {Object} selectedPostId The selected Author.\n\t */\n\tconst handleChange = ( selectedPostId ) => {\n\t\teditPost( { parent: selectedPostId } );\n\t};\n\n\treturn (\n\t\t<ComboboxControl\n\t\t\tclassName=\"editor-page-attributes__parent\"\n\t\t\tlabel={ parentPageLabel }\n\t\t\tvalue={ parentPostId }\n\t\t\toptions={ parentOptions }\n\t\t\tonFilterValueChange={ debounce( handleKeydown, 300 ) }\n\t\t\tonChange={ handleChange }\n\t\t/>\n\t);\n}\n\nexport default PageAttributesParent;\n"]}