{"version":3,"sources":["@wordpress/editor/src/components/provider/use-block-editor-settings.js"],"names":["map","pick","defaultTo","flatten","partialRight","Platform","useMemo","useDispatch","useSelect","__","store","coreStore","apiFetch","addQueryArgs","decodeEntities","mediaUpload","editorStore","fetchLinkSuggestions","search","isInitialSuggestions","type","subtype","page","perPageArg","perPage","disablePostFormats","queries","push","path","per_page","catch","Promise","all","then","results","filter","result","id","slice","url","title","useBlockEditorSettings","settings","hasTemplate","select","canUserUseUnfilteredHTML","isPostTitleSelected","canUser","canUseUnfilteredHTML","reusableBlocks","getEntityRecords","web","native","hasUploadPermissions","isTitleSelected","undo","undefined","__experimentalReusableBlocks","__experimentalFetchLinkSuggestions","__experimentalCanUserUseUnfilteredHTML","__experimentalUndo","__experimentalShouldInsertAtTheTop","outlineMode"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { map, pick, defaultTo, flatten, partialRight } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { Platform, useMemo } from '@wordpress/element';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { __ } from '@wordpress/i18n';\nimport { store as coreStore } from '@wordpress/core-data';\nimport apiFetch from '@wordpress/api-fetch';\nimport { addQueryArgs } from '@wordpress/url';\nimport { decodeEntities } from '@wordpress/html-entities';\n\n/**\n * Internal dependencies\n */\nimport { mediaUpload } from '../../utils';\nimport { store as editorStore } from '../../store';\n\n/**\n * Fetches link suggestions from the API. This function is an exact copy of a function found at:\n *\n * packages/edit-navigation/src/index.js\n *\n * It seems like there is no suitable package to import this from. Ideally it would be either part of core-data.\n * Until we refactor it, just copying the code is the simplest solution.\n *\n * @param {string} search\n * @param {Object} [searchArguments]\n * @param {number} [searchArguments.isInitialSuggestions]\n * @param {number} [searchArguments.type]\n * @param {number} [searchArguments.subtype]\n * @param {number} [searchArguments.page]\n * @param {Object} [editorSettings]\n * @param {boolean} [editorSettings.disablePostFormats=false]\n * @return {Promise<Object[]>} List of suggestions\n */\n\nconst fetchLinkSuggestions = async (\n\tsearch,\n\t{ isInitialSuggestions, type, subtype, page, perPage: perPageArg } = {},\n\t{ disablePostFormats = false } = {}\n) => {\n\tconst perPage = perPageArg || isInitialSuggestions ? 3 : 20;\n\n\tconst queries = [];\n\n\tif ( ! type || type === 'post' ) {\n\t\tqueries.push(\n\t\t\tapiFetch( {\n\t\t\t\tpath: addQueryArgs( '/wp/v2/search', {\n\t\t\t\t\tsearch,\n\t\t\t\t\tpage,\n\t\t\t\t\tper_page: perPage,\n\t\t\t\t\ttype: 'post',\n\t\t\t\t\tsubtype,\n\t\t\t\t} ),\n\t\t\t} ).catch( () => [] ) // fail by returning no results\n\t\t);\n\t}\n\n\tif ( ! type || type === 'term' ) {\n\t\tqueries.push(\n\t\t\tapiFetch( {\n\t\t\t\tpath: addQueryArgs( '/wp/v2/search', {\n\t\t\t\t\tsearch,\n\t\t\t\t\tpage,\n\t\t\t\t\tper_page: perPage,\n\t\t\t\t\ttype: 'term',\n\t\t\t\t\tsubtype,\n\t\t\t\t} ),\n\t\t\t} ).catch( () => [] )\n\t\t);\n\t}\n\n\tif ( ! disablePostFormats && ( ! type || type === 'post-format' ) ) {\n\t\tqueries.push(\n\t\t\tapiFetch( {\n\t\t\t\tpath: addQueryArgs( '/wp/v2/search', {\n\t\t\t\t\tsearch,\n\t\t\t\t\tpage,\n\t\t\t\t\tper_page: perPage,\n\t\t\t\t\ttype: 'post-format',\n\t\t\t\t\tsubtype,\n\t\t\t\t} ),\n\t\t\t} ).catch( () => [] )\n\t\t);\n\t}\n\n\treturn Promise.all( queries ).then( ( results ) => {\n\t\treturn map(\n\t\t\tflatten( results )\n\t\t\t\t.filter( ( result ) => !! result.id )\n\t\t\t\t.slice( 0, perPage ),\n\t\t\t( result ) => ( {\n\t\t\t\tid: result.id,\n\t\t\t\turl: result.url,\n\t\t\t\ttitle: decodeEntities( result.title ) || __( '(no title)' ),\n\t\t\t\ttype: result.subtype || result.type,\n\t\t\t} )\n\t\t);\n\t} );\n};\n\n/**\n * React hook used to compute the block editor settings to use for the post editor.\n *\n * @param {Object}  settings    EditorProvider settings prop.\n * @param {boolean} hasTemplate Whether template mode is enabled.\n *\n * @return {Object} Block Editor Settings.\n */\nfunction useBlockEditorSettings( settings, hasTemplate ) {\n\tconst {\n\t\treusableBlocks,\n\t\thasUploadPermissions,\n\t\tcanUseUnfilteredHTML,\n\t\tisTitleSelected,\n\t} = useSelect( ( select ) => {\n\t\tconst { canUserUseUnfilteredHTML, isPostTitleSelected } = select(\n\t\t\teditorStore\n\t\t);\n\t\tconst { canUser } = select( coreStore );\n\n\t\treturn {\n\t\t\tcanUseUnfilteredHTML: canUserUseUnfilteredHTML(),\n\t\t\treusableBlocks: select( 'core' ).getEntityRecords(\n\t\t\t\t'postType',\n\t\t\t\t'wp_block',\n\t\t\t\t/**\n\t\t\t\t * Unbounded queries are not supported on native so as a workaround we set per_page with the maximum value.\n\t\t\t\t * Related issue: https://github.com/wordpress-mobile/gutenberg-mobile/issues/2661\n\t\t\t\t */\n\t\t\t\t{ per_page: Platform.select( { web: -1, native: 100 } ) }\n\t\t\t),\n\t\t\thasUploadPermissions: defaultTo(\n\t\t\t\tcanUser( 'create', 'media' ),\n\t\t\t\ttrue\n\t\t\t),\n\t\t\t// This selector is only defined on mobile.\n\t\t\tisTitleSelected: isPostTitleSelected && isPostTitleSelected(),\n\t\t};\n\t}, [] );\n\n\tconst { undo } = useDispatch( editorStore );\n\n\treturn useMemo(\n\t\t() => ( {\n\t\t\t...pick( settings, [\n\t\t\t\t'__experimentalBlockDirectory',\n\t\t\t\t'__experimentalBlockPatterns',\n\t\t\t\t'__experimentalBlockPatternCategories',\n\t\t\t\t'__experimentalFeatures',\n\t\t\t\t'__experimentalGlobalStylesUserEntityId',\n\t\t\t\t'__experimentalGlobalStylesBaseStyles',\n\t\t\t\t'__experimentalPreferredStyleVariations',\n\t\t\t\t'__experimentalSetIsInserterOpened',\n\t\t\t\t'alignWide',\n\t\t\t\t'allowedBlockTypes',\n\t\t\t\t'availableLegacyWidgets',\n\t\t\t\t'bodyPlaceholder',\n\t\t\t\t'codeEditingEnabled',\n\t\t\t\t'colors',\n\t\t\t\t'disableCustomColors',\n\t\t\t\t'disableCustomFontSizes',\n\t\t\t\t'disableCustomGradients',\n\t\t\t\t'enableCustomUnits',\n\t\t\t\t'enableCustomLineHeight',\n\t\t\t\t'focusMode',\n\t\t\t\t'fontSizes',\n\t\t\t\t'gradients',\n\t\t\t\t'hasFixedToolbar',\n\t\t\t\t'hasReducedUI',\n\t\t\t\t'imageEditing',\n\t\t\t\t'imageSizes',\n\t\t\t\t'imageDimensions',\n\t\t\t\t'isRTL',\n\t\t\t\t'keepCaretInsideBlock',\n\t\t\t\t'maxWidth',\n\t\t\t\t'onUpdateDefaultBlockStyles',\n\t\t\t\t'styles',\n\t\t\t\t'template',\n\t\t\t\t'templateLock',\n\t\t\t\t'titlePlaceholder',\n\t\t\t] ),\n\t\t\tmediaUpload: hasUploadPermissions ? mediaUpload : undefined,\n\t\t\t__experimentalReusableBlocks: reusableBlocks,\n\t\t\t__experimentalFetchLinkSuggestions: partialRight(\n\t\t\t\tfetchLinkSuggestions,\n\t\t\t\tsettings\n\t\t\t),\n\t\t\t__experimentalCanUserUseUnfilteredHTML: canUseUnfilteredHTML,\n\t\t\t__experimentalUndo: undo,\n\t\t\t__experimentalShouldInsertAtTheTop: isTitleSelected,\n\t\t\toutlineMode: hasTemplate,\n\t\t} ),\n\t\t[\n\t\t\tsettings,\n\t\t\thasUploadPermissions,\n\t\t\treusableBlocks,\n\t\t\tcanUseUnfilteredHTML,\n\t\t\tundo,\n\t\t\tisTitleSelected,\n\t\t\thasTemplate,\n\t\t]\n\t);\n}\n\nexport default useBlockEditorSettings;\n"]}