{"version":3,"sources":["@wordpress/editor/src/components/provider/index.js"],"names":["EditorProvider","__unstableTemplate","post","settings","recovery","initialEdits","children","defaultBlockContext","type","postId","id","postType","select","editorStore","getEditorSelectionStart","getEditorSelectionEnd","__unstableIsEditorReady","isReady","selectionStart","selectionEnd","blocks","onInput","onChange","editorSettings","updatePostLock","setupEditor","updateEditorSettings","__experimentalTearDownEditor","noticesStore","createWarningNotice","postLock","template","autosave","actions","label","url","editLink"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useEffect, useLayoutEffect, useMemo } from '@wordpress/element';\nimport { useDispatch, useSelect } from '@wordpress/data';\nimport { __ } from '@wordpress/i18n';\nimport { EntityProvider, useEntityBlockEditor } from '@wordpress/core-data';\nimport {\n\tBlockEditorProvider,\n\tBlockContextProvider,\n} from '@wordpress/block-editor';\nimport { ReusableBlocksMenuItems } from '@wordpress/reusable-blocks';\nimport { store as noticesStore } from '@wordpress/notices';\n\n/**\n * Internal dependencies\n */\nimport withRegistryProvider from './with-registry-provider';\nimport { store as editorStore } from '../../store';\nimport useBlockEditorSettings from './use-block-editor-settings';\n\nfunction EditorProvider( {\n\t__unstableTemplate,\n\tpost,\n\tsettings,\n\trecovery,\n\tinitialEdits,\n\tchildren,\n} ) {\n\tconst defaultBlockContext = useMemo( () => {\n\t\tif ( post.type === 'wp_template' ) {\n\t\t\treturn {};\n\t\t}\n\t\treturn { postId: post.id, postType: post.type };\n\t}, [ post.id, post.type ] );\n\tconst { selectionEnd, selectionStart, isReady } = useSelect( ( select ) => {\n\t\tconst {\n\t\t\tgetEditorSelectionStart,\n\t\t\tgetEditorSelectionEnd,\n\t\t\t__unstableIsEditorReady,\n\t\t} = select( editorStore );\n\t\treturn {\n\t\t\tisReady: __unstableIsEditorReady(),\n\t\t\tselectionStart: getEditorSelectionStart(),\n\t\t\tselectionEnd: getEditorSelectionEnd(),\n\t\t};\n\t}, [] );\n\tconst { id, type } = __unstableTemplate ?? post;\n\tconst [ blocks, onInput, onChange ] = useEntityBlockEditor(\n\t\t'postType',\n\t\ttype,\n\t\t{ id }\n\t);\n\tconst editorSettings = useBlockEditorSettings(\n\t\tsettings,\n\t\t!! __unstableTemplate\n\t);\n\tconst {\n\t\tupdatePostLock,\n\t\tsetupEditor,\n\t\tupdateEditorSettings,\n\t\t__experimentalTearDownEditor,\n\t} = useDispatch( editorStore );\n\tconst { createWarningNotice } = useDispatch( noticesStore );\n\n\t// Iniitialize and tear down the editor.\n\t// Ideally this should be synced on each change and not just something you do once.\n\tuseLayoutEffect( () => {\n\t\t// Assume that we don't need to initialize in the case of an error recovery.\n\t\tif ( recovery ) {\n\t\t\treturn;\n\t\t}\n\n\t\tupdatePostLock( settings.postLock );\n\t\tsetupEditor( post, initialEdits, settings.template );\n\t\tif ( settings.autosave ) {\n\t\t\tcreateWarningNotice(\n\t\t\t\t__(\n\t\t\t\t\t'There is an autosave of this post that is more recent than the version below.'\n\t\t\t\t),\n\t\t\t\t{\n\t\t\t\t\tid: 'autosave-exists',\n\t\t\t\t\tactions: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlabel: __( 'View the autosave' ),\n\t\t\t\t\t\t\turl: settings.autosave.editLink,\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\treturn () => {\n\t\t\t__experimentalTearDownEditor();\n\t\t};\n\t}, [] );\n\n\t// Synchronize the editor settings as they change\n\tuseEffect( () => {\n\t\tupdateEditorSettings( settings );\n\t}, [ settings ] );\n\n\tif ( ! isReady ) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<EntityProvider kind=\"root\" type=\"site\">\n\t\t\t<EntityProvider kind=\"postType\" type={ post.type } id={ post.id }>\n\t\t\t\t<BlockContextProvider value={ defaultBlockContext }>\n\t\t\t\t\t<BlockEditorProvider\n\t\t\t\t\t\tvalue={ blocks }\n\t\t\t\t\t\tonChange={ onChange }\n\t\t\t\t\t\tonInput={ onInput }\n\t\t\t\t\t\tselectionStart={ selectionStart }\n\t\t\t\t\t\tselectionEnd={ selectionEnd }\n\t\t\t\t\t\tsettings={ editorSettings }\n\t\t\t\t\t\tuseSubRegistry={ false }\n\t\t\t\t\t>\n\t\t\t\t\t\t{ children }\n\t\t\t\t\t\t<ReusableBlocksMenuItems />\n\t\t\t\t\t</BlockEditorProvider>\n\t\t\t\t</BlockContextProvider>\n\t\t\t</EntityProvider>\n\t\t</EntityProvider>\n\t);\n}\n\nexport default withRegistryProvider( EditorProvider );\n"]}