{"version":3,"sources":["@wordpress/block-library/src/pullquote/edit.js"],"names":["classnames","includes","__","Platform","useEffect","useRef","RichText","ContrastChecker","InspectorControls","withColors","PanelColorSettings","useBlockProps","createBlock","Figure","BlockQuote","SOLID_COLOR_CLASS","PullQuoteEdit","colorUtils","textColor","attributes","value","citation","setAttributes","setTextColor","setMainColor","mainColor","isSelected","insertBlocksAfter","wasTextColorAutomaticallyComputed","blockProps","style","className","isSolidColorStyle","newBlockProps","color","class","backgroundColor","borderColor","pullQuoteMainColorSetter","colorValue","needTextColor","current","shouldSetTextColor","customMainColor","getMostReadableColor","pullQuoteTextColorSetter","undefined","nextValue","isEmpty","nextCitation","OS","onChange","label"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\nimport { includes } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { Platform, useEffect, useRef } from '@wordpress/element';\nimport {\n\tRichText,\n\tContrastChecker,\n\tInspectorControls,\n\twithColors,\n\tPanelColorSettings,\n\tuseBlockProps,\n} from '@wordpress/block-editor';\nimport { createBlock } from '@wordpress/blocks';\n\n/**\n * Internal dependencies\n */\nimport { Figure } from './figure';\nimport { BlockQuote } from './blockquote';\n\n/**\n * Internal dependencies\n */\nimport { SOLID_COLOR_CLASS } from './shared';\n\nfunction PullQuoteEdit( {\n\tcolorUtils,\n\ttextColor,\n\tattributes: { value, citation },\n\tsetAttributes,\n\tsetTextColor,\n\tsetMainColor,\n\tmainColor,\n\tisSelected,\n\tinsertBlocksAfter,\n} ) {\n\tconst wasTextColorAutomaticallyComputed = useRef( false );\n\tconst blockProps = useBlockProps();\n\tconst { style = {}, className } = blockProps;\n\tconst isSolidColorStyle = includes( className, SOLID_COLOR_CLASS );\n\tconst newBlockProps = {\n\t\t...blockProps,\n\t\tclassName: classnames( className, {\n\t\t\t'has-background': isSolidColorStyle && mainColor.color,\n\t\t\t[ mainColor.class ]: isSolidColorStyle && mainColor.class,\n\t\t} ),\n\t\tstyle: isSolidColorStyle\n\t\t\t? { ...style, backgroundColor: mainColor.color }\n\t\t\t: { ...style, borderColor: mainColor.color },\n\t};\n\n\tfunction pullQuoteMainColorSetter( colorValue ) {\n\t\tconst needTextColor =\n\t\t\t! textColor.color || wasTextColorAutomaticallyComputed.current;\n\t\tconst shouldSetTextColor = isSolidColorStyle && needTextColor;\n\n\t\tif ( isSolidColorStyle ) {\n\t\t\t// If we use the solid color style, set the color using the normal mechanism.\n\t\t\tsetMainColor( colorValue );\n\t\t} else {\n\t\t\t// If we use the default style, set the color as a custom color to force the usage of an inline style.\n\t\t\t// Default style uses a border color for which classes are not available.\n\t\t\tsetAttributes( { customMainColor: colorValue } );\n\t\t}\n\n\t\tif ( shouldSetTextColor ) {\n\t\t\tif ( colorValue ) {\n\t\t\t\twasTextColorAutomaticallyComputed.current = true;\n\t\t\t\tsetTextColor( colorUtils.getMostReadableColor( colorValue ) );\n\t\t\t} else if ( wasTextColorAutomaticallyComputed.current ) {\n\t\t\t\t// We have to unset our previously computed text color on unsetting the main color.\n\t\t\t\twasTextColorAutomaticallyComputed.current = false;\n\t\t\t\tsetTextColor();\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction pullQuoteTextColorSetter( colorValue ) {\n\t\tsetTextColor( colorValue );\n\t\twasTextColorAutomaticallyComputed.current = false;\n\t}\n\n\tuseEffect( () => {\n\t\t// If the block includes a named color and we switched from the\n\t\t// solid color style to the default style.\n\t\tif ( mainColor && ! isSolidColorStyle ) {\n\t\t\t// Remove the named color, and set the color as a custom color.\n\t\t\t// This is done because named colors use classes, in the default style we use a border color,\n\t\t\t// and themes don't set classes for border colors.\n\t\t\tsetAttributes( {\n\t\t\t\tmainColor: undefined,\n\t\t\t\tcustomMainColor: mainColor.color,\n\t\t\t} );\n\t\t}\n\t}, [ isSolidColorStyle, mainColor ] );\n\n\treturn (\n\t\t<>\n\t\t\t<Figure { ...newBlockProps }>\n\t\t\t\t<BlockQuote\n\t\t\t\t\tstyle={ {\n\t\t\t\t\t\tcolor: textColor.color,\n\t\t\t\t\t} }\n\t\t\t\t\tclassName={\n\t\t\t\t\t\ttextColor.color &&\n\t\t\t\t\t\tclassnames( 'has-text-color', {\n\t\t\t\t\t\t\t[ textColor.class ]: textColor.class,\n\t\t\t\t\t\t} )\n\t\t\t\t\t}\n\t\t\t\t>\n\t\t\t\t\t<RichText\n\t\t\t\t\t\tidentifier=\"value\"\n\t\t\t\t\t\tmultiline\n\t\t\t\t\t\tvalue={ value }\n\t\t\t\t\t\tonChange={ ( nextValue ) =>\n\t\t\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t\t\tvalue: nextValue,\n\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t}\n\t\t\t\t\t\taria-label={ __( 'Pullquote text' ) }\n\t\t\t\t\t\tplaceholder={\n\t\t\t\t\t\t\t// translators: placeholder text used for the quote\n\t\t\t\t\t\t\t__( 'Write quote…' )\n\t\t\t\t\t\t}\n\t\t\t\t\t\ttextAlign=\"center\"\n\t\t\t\t\t/>\n\t\t\t\t\t{ ( ! RichText.isEmpty( citation ) || isSelected ) && (\n\t\t\t\t\t\t<RichText\n\t\t\t\t\t\t\tidentifier=\"citation\"\n\t\t\t\t\t\t\tvalue={ citation }\n\t\t\t\t\t\t\taria-label={ __( 'Pullquote citation text' ) }\n\t\t\t\t\t\t\tplaceholder={\n\t\t\t\t\t\t\t\t// translators: placeholder text used for the citation\n\t\t\t\t\t\t\t\t__( 'Write citation…' )\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonChange={ ( nextCitation ) =>\n\t\t\t\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t\t\t\tcitation: nextCitation,\n\t\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tclassName=\"wp-block-pullquote__citation\"\n\t\t\t\t\t\t\t__unstableMobileNoFocusOnMount\n\t\t\t\t\t\t\ttextAlign=\"center\"\n\t\t\t\t\t\t\t__unstableOnSplitAtEnd={ () =>\n\t\t\t\t\t\t\t\tinsertBlocksAfter(\n\t\t\t\t\t\t\t\t\tcreateBlock( 'core/paragraph' )\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t</BlockQuote>\n\t\t\t</Figure>\n\t\t\t{ Platform.OS === 'web' && (\n\t\t\t\t<InspectorControls>\n\t\t\t\t\t<PanelColorSettings\n\t\t\t\t\t\ttitle={ __( 'Color settings' ) }\n\t\t\t\t\t\tcolorSettings={ [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvalue: mainColor.color,\n\t\t\t\t\t\t\t\tonChange: pullQuoteMainColorSetter,\n\t\t\t\t\t\t\t\tlabel: __( 'Main color' ),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvalue: textColor.color,\n\t\t\t\t\t\t\t\tonChange: pullQuoteTextColorSetter,\n\t\t\t\t\t\t\t\tlabel: __( 'Text color' ),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t] }\n\t\t\t\t\t>\n\t\t\t\t\t\t{ isSolidColorStyle && (\n\t\t\t\t\t\t\t<ContrastChecker\n\t\t\t\t\t\t\t\t{ ...{\n\t\t\t\t\t\t\t\t\ttextColor: textColor.color,\n\t\t\t\t\t\t\t\t\tbackgroundColor: mainColor.color,\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\tisLargeText={ false }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t) }\n\t\t\t\t\t</PanelColorSettings>\n\t\t\t\t</InspectorControls>\n\t\t\t) }\n\t\t</>\n\t);\n}\n\nexport default withColors( {\n\tmainColor: 'background-color',\n\ttextColor: 'color',\n} )( PullQuoteEdit );\n"]}