import _defineProperty from "@babel/runtime/helpers/esm/defineProperty";
import _slicedToArray from "@babel/runtime/helpers/esm/slicedToArray";
import { createElement, Fragment } from "@wordpress/element";

/**
 * External dependencies
 */
import classnames from 'classnames';
/**
 * WordPress dependencies
 */

import { useState } from '@wordpress/element';
import { InnerBlocks, __experimentalUseInnerBlocksProps as useInnerBlocksProps, InspectorControls, BlockControls, useBlockProps } from '@wordpress/block-editor';
import { useDispatch, withSelect, withDispatch } from '@wordpress/data';
import { PanelBody, ToggleControl, ToolbarGroup } from '@wordpress/components';
import { compose } from '@wordpress/compose';
import { __ } from '@wordpress/i18n';
/**
 * Internal dependencies
 */

import useBlockNavigator from './use-block-navigator';
import { justifyLeft, justifyCenter, justifyRight, justifySpaceBetween } from '@wordpress/icons';
import NavigationPlaceholder from './placeholder';
import PlaceholderPreview from './placeholder-preview';

function Navigation(_ref) {
  var _classnames;

  var selectedBlockHasDescendants = _ref.selectedBlockHasDescendants,
      attributes = _ref.attributes,
      setAttributes = _ref.setAttributes,
      clientId = _ref.clientId,
      hasExistingNavItems = _ref.hasExistingNavItems,
      isImmediateParentOfSelectedBlock = _ref.isImmediateParentOfSelectedBlock,
      isSelected = _ref.isSelected,
      updateInnerBlocks = _ref.updateInnerBlocks,
      className = _ref.className,
      _ref$hasSubmenuIndica = _ref.hasSubmenuIndicatorSetting,
      hasSubmenuIndicatorSetting = _ref$hasSubmenuIndica === void 0 ? true : _ref$hasSubmenuIndica,
      _ref$hasItemJustifica = _ref.hasItemJustificationControls,
      hasItemJustificationControls = _ref$hasItemJustifica === void 0 ? attributes.orientation === 'horizontal' : _ref$hasItemJustifica,
      _ref$hasListViewModal = _ref.hasListViewModal,
      hasListViewModal = _ref$hasListViewModal === void 0 ? true : _ref$hasListViewModal;
  var navIcons = {
    left: justifyLeft,
    center: justifyCenter,
    right: justifyRight,
    'space-between': justifySpaceBetween
  };

  var _useState = useState(!hasExistingNavItems),
      _useState2 = _slicedToArray(_useState, 2),
      isPlaceholderShown = _useState2[0],
      setIsPlaceholderShown = _useState2[1];

  var _useDispatch = useDispatch('core/block-editor'),
      selectBlock = _useDispatch.selectBlock;

  var blockProps = useBlockProps({
    className: classnames(className, (_classnames = {}, _defineProperty(_classnames, "items-justified-".concat(attributes.itemsJustification), attributes.itemsJustification), _defineProperty(_classnames, 'is-vertical', attributes.orientation === 'vertical'), _classnames))
  });

  var _useBlockNavigator = useBlockNavigator(clientId),
      navigatorToolbarButton = _useBlockNavigator.navigatorToolbarButton,
      navigatorModal = _useBlockNavigator.navigatorModal;

  var innerBlocksProps = useInnerBlocksProps({
    className: 'wp-block-navigation__container'
  }, {
    allowedBlocks: ['core/navigation-link', 'core/search', 'core/social-links'],
    orientation: attributes.orientation || 'horizontal',
    renderAppender: isImmediateParentOfSelectedBlock && !selectedBlockHasDescendants || isSelected ? InnerBlocks.DefaultAppender : false,
    __experimentalAppenderTagName: 'li',
    __experimentalCaptureToolbars: true,
    // Template lock set to false here so that the Nav
    // Block on the experimental menus screen does not
    // inherit templateLock={ 'all' }.
    templateLock: false,
    __experimentalLayout: {
      type: 'default',
      alignments: []
    },
    placeholder: createElement(PlaceholderPreview, null)
  });

  if (isPlaceholderShown) {
    return createElement("div", blockProps, createElement(NavigationPlaceholder, {
      onCreate: function onCreate(blocks, selectNavigationBlock) {
        setIsPlaceholderShown(false);
        updateInnerBlocks(blocks);

        if (selectNavigationBlock) {
          selectBlock(clientId);
        }
      }
    }));
  }

  function handleItemsAlignment(align) {
    return function () {
      var itemsJustification = attributes.itemsJustification === align ? undefined : align;
      setAttributes({
        itemsJustification: itemsJustification
      });
    };
  }

  var POPOVER_PROPS = {
    position: 'bottom right',
    isAlternate: true
  };
  return createElement(Fragment, null, createElement(BlockControls, null, hasItemJustificationControls && createElement(ToolbarGroup, {
    icon: attributes.itemsJustification ? navIcons[attributes.itemsJustification] : navIcons.left,
    popoverProps: POPOVER_PROPS,
    label: __('Change items justification'),
    isCollapsed: true,
    controls: [{
      icon: justifyLeft,
      title: __('Justify items left'),
      isActive: 'left' === attributes.itemsJustification,
      onClick: handleItemsAlignment('left')
    }, {
      icon: justifyCenter,
      title: __('Justify items center'),
      isActive: 'center' === attributes.itemsJustification,
      onClick: handleItemsAlignment('center')
    }, {
      icon: justifyRight,
      title: __('Justify items right'),
      isActive: 'right' === attributes.itemsJustification,
      onClick: handleItemsAlignment('right')
    }, {
      icon: justifySpaceBetween,
      title: __('Space between items'),
      isActive: 'space-between' === attributes.itemsJustification,
      onClick: handleItemsAlignment('space-between')
    }]
  }), hasListViewModal && createElement(ToolbarGroup, null, navigatorToolbarButton)), hasListViewModal && navigatorModal, createElement(InspectorControls, null, hasSubmenuIndicatorSetting && createElement(PanelBody, {
    title: __('Display settings')
  }, createElement(ToggleControl, {
    checked: attributes.showSubmenuIcon,
    onChange: function onChange(value) {
      setAttributes({
        showSubmenuIcon: value
      });
    },
    label: __('Show submenu indicator icons')
  }))), createElement("nav", blockProps, createElement("ul", innerBlocksProps)));
}

export default compose([withSelect(function (select, _ref2) {
  var _getClientIdsOfDescen;

  var clientId = _ref2.clientId;
  var innerBlocks = select('core/block-editor').getBlocks(clientId);

  var _select = select('core/block-editor'),
      getClientIdsOfDescendants = _select.getClientIdsOfDescendants,
      hasSelectedInnerBlock = _select.hasSelectedInnerBlock,
      getSelectedBlockClientId = _select.getSelectedBlockClientId;

  var isImmediateParentOfSelectedBlock = hasSelectedInnerBlock(clientId, false);
  var selectedBlockId = getSelectedBlockClientId();
  var selectedBlockHasDescendants = !!((_getClientIdsOfDescen = getClientIdsOfDescendants([selectedBlockId])) !== null && _getClientIdsOfDescen !== void 0 && _getClientIdsOfDescen.length);
  return {
    isImmediateParentOfSelectedBlock: isImmediateParentOfSelectedBlock,
    selectedBlockHasDescendants: selectedBlockHasDescendants,
    hasExistingNavItems: !!innerBlocks.length
  };
}), withDispatch(function (dispatch, _ref3) {
  var clientId = _ref3.clientId;
  return {
    updateInnerBlocks: function updateInnerBlocks(blocks) {
      if ((blocks === null || blocks === void 0 ? void 0 : blocks.length) === 0) {
        return false;
      }

      dispatch('core/block-editor').replaceInnerBlocks(clientId, blocks, true);
    }
  };
})])(Navigation);
//# sourceMappingURL=edit.js.map