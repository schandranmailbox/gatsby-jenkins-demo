{"version":3,"sources":["@wordpress/block-library/src/image/edit.native.js"],"names":["View","TouchableWithoutFeedback","isEmpty","get","find","map","Component","requestMediaImport","mediaUploadSync","requestImageFailedRetryDialog","requestImageUploadCancelDialog","requestImageFullscreenPreview","CycleSelectControl","Icon","PanelBody","TextControl","ToolbarButton","ToolbarGroup","Image","WIDE_ALIGNMENTS","LinkSettingsNavigation","BlockCaption","MediaPlaceholder","MediaUpload","MediaUploadProgress","MEDIA_TYPE_IMAGE","BlockControls","InspectorControls","BlockAlignmentToolbar","BlockStyles","__","sprintf","getProtocol","hasQueryArg","doAction","hasAction","compose","withPreferredColorScheme","withSelect","image","placeholderIcon","textColor","replace","expand","styles","getUpdatedLinkTargetSettings","LINK_DESTINATION_CUSTOM","DEFAULT_SIZE_SLUG","getUrlForSlug","sizeSlug","ImageEdit","props","state","isCaptionSelected","finishMediaUploadWithSuccess","bind","finishMediaUploadWithFailure","mediaUploadStateReset","onSelectMediaUploadOption","updateMediaProgress","updateAlt","updateImageURL","onSetLinkDestination","onSetNewTab","onSetSizeSlug","onImagePressed","onFocusCaption","updateAlignment","accessibilityLabelCreator","attributes","setAttributes","id","url","console","warn","isUploadInProgress","previousProps","source_url","caption","setState","payload","mediaUrl","mediaServerId","mediaId","newAlt","alt","width","undefined","height","nextAlign","extraUpdatedAttributes","Object","values","alignments","includes","align","href","linkDestination","value","updatedLinkTarget","media","mediaAttributes","additionalAttributes","onFocus","getStylesFromColorScheme","iconPlaceholder","iconPlaceholderDark","isLinkSheetVisible","unMappedAttributes","mappedAttributes","setMappedAttributes","restAttributes","options","label","placeholder","autoFocus","autoFill","openInNewTab","linkRel","dismissSheet","isSelected","imageSizes","clientId","className","sizeOptions","name","slug","sizeOptionsValid","getToolbarEditButton","open","getInspectorControls","panelBody","newValue","getLinkSettings","content","getPlaceholderIcon","alignToFlex","left","center","right","full","wide","getImageComponent","openMediaOptions","getMediaOptions","isUploadFailed","retryMessage","getWidth","onBlur","insertBlocksAfter","select","getMedia","getSettings","isNotFileUrl","shouldGetMedia"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { View, TouchableWithoutFeedback } from 'react-native';\nimport { isEmpty, get, find, map } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport {\n\trequestMediaImport,\n\tmediaUploadSync,\n\trequestImageFailedRetryDialog,\n\trequestImageUploadCancelDialog,\n\trequestImageFullscreenPreview,\n} from '@wordpress/react-native-bridge';\nimport {\n\tCycleSelectControl,\n\tIcon,\n\tPanelBody,\n\tTextControl,\n\tToolbarButton,\n\tToolbarGroup,\n\tImage,\n\tWIDE_ALIGNMENTS,\n\tLinkSettingsNavigation,\n} from '@wordpress/components';\nimport {\n\tBlockCaption,\n\tMediaPlaceholder,\n\tMediaUpload,\n\tMediaUploadProgress,\n\tMEDIA_TYPE_IMAGE,\n\tBlockControls,\n\tInspectorControls,\n\tBlockAlignmentToolbar,\n\tBlockStyles,\n} from '@wordpress/block-editor';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { getProtocol, hasQueryArg } from '@wordpress/url';\nimport { doAction, hasAction } from '@wordpress/hooks';\nimport { compose, withPreferredColorScheme } from '@wordpress/compose';\nimport { withSelect } from '@wordpress/data';\nimport {\n\timage as placeholderIcon,\n\ttextColor,\n\treplace,\n\texpand,\n} from '@wordpress/icons';\n\n/**\n * Internal dependencies\n */\nimport styles from './styles.scss';\nimport { getUpdatedLinkTargetSettings } from './utils';\n\nimport { LINK_DESTINATION_CUSTOM, DEFAULT_SIZE_SLUG } from './constants';\n\nconst getUrlForSlug = ( image, { sizeSlug } ) => {\n\treturn get( image, [ 'media_details', 'sizes', sizeSlug, 'source_url' ] );\n};\n\nexport class ImageEdit extends Component {\n\tconstructor( props ) {\n\t\tsuper( props );\n\n\t\tthis.state = {\n\t\t\tisCaptionSelected: false,\n\t\t};\n\n\t\tthis.finishMediaUploadWithSuccess = this.finishMediaUploadWithSuccess.bind(\n\t\t\tthis\n\t\t);\n\t\tthis.finishMediaUploadWithFailure = this.finishMediaUploadWithFailure.bind(\n\t\t\tthis\n\t\t);\n\t\tthis.mediaUploadStateReset = this.mediaUploadStateReset.bind( this );\n\t\tthis.onSelectMediaUploadOption = this.onSelectMediaUploadOption.bind(\n\t\t\tthis\n\t\t);\n\t\tthis.updateMediaProgress = this.updateMediaProgress.bind( this );\n\t\tthis.updateAlt = this.updateAlt.bind( this );\n\t\tthis.updateImageURL = this.updateImageURL.bind( this );\n\t\tthis.onSetLinkDestination = this.onSetLinkDestination.bind( this );\n\t\tthis.onSetNewTab = this.onSetNewTab.bind( this );\n\t\tthis.onSetSizeSlug = this.onSetSizeSlug.bind( this );\n\t\tthis.onImagePressed = this.onImagePressed.bind( this );\n\t\tthis.onFocusCaption = this.onFocusCaption.bind( this );\n\t\tthis.updateAlignment = this.updateAlignment.bind( this );\n\t\tthis.accessibilityLabelCreator = this.accessibilityLabelCreator.bind(\n\t\t\tthis\n\t\t);\n\t}\n\n\tcomponentDidMount() {\n\t\tconst { attributes, setAttributes } = this.props;\n\t\t// This will warn when we have `id` defined, while `url` is undefined.\n\t\t// This may help track this issue: https://github.com/wordpress-mobile/WordPress-Android/issues/9768\n\t\t// where a cancelled image upload was resulting in a subsequent crash.\n\t\tif ( attributes.id && ! attributes.url ) {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.warn( 'Attributes has id with no url.' );\n\t\t}\n\n\t\t// Detect any pasted image and start an upload\n\t\tif (\n\t\t\t! attributes.id &&\n\t\t\tattributes.url &&\n\t\t\tgetProtocol( attributes.url ) === 'file:'\n\t\t) {\n\t\t\trequestMediaImport( attributes.url, ( id, url ) => {\n\t\t\t\tif ( url ) {\n\t\t\t\t\tsetAttributes( { id, url } );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\t// Make sure we mark any temporary images as failed if they failed while\n\t\t// the editor wasn't open\n\t\tif (\n\t\t\tattributes.id &&\n\t\t\tattributes.url &&\n\t\t\tgetProtocol( attributes.url ) === 'file:'\n\t\t) {\n\t\t\tmediaUploadSync();\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\t// this action will only exist if the user pressed the trash button on the block holder\n\t\tif (\n\t\t\thasAction( 'blocks.onRemoveBlockCheckUpload' ) &&\n\t\t\tthis.state.isUploadInProgress\n\t\t) {\n\t\t\tdoAction(\n\t\t\t\t'blocks.onRemoveBlockCheckUpload',\n\t\t\t\tthis.props.attributes.id\n\t\t\t);\n\t\t}\n\t}\n\n\tcomponentDidUpdate( previousProps ) {\n\t\tif ( ! previousProps.image && this.props.image ) {\n\t\t\tconst { image, attributes } = this.props;\n\t\t\tconst url = getUrlForSlug( image, attributes ) || image.source_url;\n\t\t\tthis.props.setAttributes( { url } );\n\t\t}\n\t}\n\n\tstatic getDerivedStateFromProps( props, state ) {\n\t\t// Avoid a UI flicker in the toolbar by insuring that isCaptionSelected\n\t\t// is updated immediately any time the isSelected prop becomes false\n\t\treturn {\n\t\t\tisCaptionSelected: props.isSelected && state.isCaptionSelected,\n\t\t};\n\t}\n\n\taccessibilityLabelCreator( caption ) {\n\t\treturn isEmpty( caption )\n\t\t\t? /* translators: accessibility text. Empty image caption. */\n\t\t\t  'Image caption. Empty'\n\t\t\t: sprintf(\n\t\t\t\t\t/* translators: accessibility text. %s: image caption. */\n\t\t\t\t\t__( 'Image caption. %s' ),\n\t\t\t\t\tcaption\n\t\t\t  );\n\t}\n\n\tonImagePressed() {\n\t\tconst { attributes, image } = this.props;\n\n\t\tif ( this.state.isUploadInProgress ) {\n\t\t\trequestImageUploadCancelDialog( attributes.id );\n\t\t} else if (\n\t\t\tattributes.id &&\n\t\t\tgetProtocol( attributes.url ) === 'file:'\n\t\t) {\n\t\t\trequestImageFailedRetryDialog( attributes.id );\n\t\t} else if ( ! this.state.isCaptionSelected ) {\n\t\t\trequestImageFullscreenPreview(\n\t\t\t\tattributes.url,\n\t\t\t\timage && image.source_url\n\t\t\t);\n\t\t}\n\n\t\tthis.setState( {\n\t\t\tisCaptionSelected: false,\n\t\t} );\n\t}\n\n\tupdateMediaProgress( payload ) {\n\t\tconst { setAttributes } = this.props;\n\t\tif ( payload.mediaUrl ) {\n\t\t\tsetAttributes( { url: payload.mediaUrl } );\n\t\t}\n\n\t\tif ( ! this.state.isUploadInProgress ) {\n\t\t\tthis.setState( { isUploadInProgress: true } );\n\t\t}\n\t}\n\n\tfinishMediaUploadWithSuccess( payload ) {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { url: payload.mediaUrl, id: payload.mediaServerId } );\n\t\tthis.setState( { isUploadInProgress: false } );\n\t}\n\n\tfinishMediaUploadWithFailure( payload ) {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { id: payload.mediaId } );\n\t\tthis.setState( { isUploadInProgress: false } );\n\t}\n\n\tmediaUploadStateReset() {\n\t\tconst { setAttributes } = this.props;\n\n\t\tsetAttributes( { id: null, url: null } );\n\t\tthis.setState( { isUploadInProgress: false } );\n\t}\n\n\tupdateAlt( newAlt ) {\n\t\tthis.props.setAttributes( { alt: newAlt } );\n\t}\n\n\tupdateImageURL( url ) {\n\t\tthis.props.setAttributes( {\n\t\t\turl,\n\t\t\twidth: undefined,\n\t\t\theight: undefined,\n\t\t} );\n\t}\n\n\tupdateAlignment( nextAlign ) {\n\t\tconst extraUpdatedAttributes = Object.values(\n\t\t\tWIDE_ALIGNMENTS.alignments\n\t\t).includes( nextAlign )\n\t\t\t? { width: undefined, height: undefined }\n\t\t\t: {};\n\t\tthis.props.setAttributes( {\n\t\t\t...extraUpdatedAttributes,\n\t\t\talign: nextAlign,\n\t\t} );\n\t}\n\n\tonSetLinkDestination( href ) {\n\t\tthis.props.setAttributes( {\n\t\t\tlinkDestination: LINK_DESTINATION_CUSTOM,\n\t\t\thref,\n\t\t} );\n\t}\n\n\tonSetNewTab( value ) {\n\t\tconst updatedLinkTarget = getUpdatedLinkTargetSettings(\n\t\t\tvalue,\n\t\t\tthis.props.attributes\n\t\t);\n\t\tthis.props.setAttributes( updatedLinkTarget );\n\t}\n\n\tonSetSizeSlug( sizeSlug ) {\n\t\tconst { image } = this.props;\n\n\t\tconst url = getUrlForSlug( image, { sizeSlug } );\n\t\tif ( ! url ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tthis.props.setAttributes( {\n\t\t\turl,\n\t\t\twidth: undefined,\n\t\t\theight: undefined,\n\t\t\tsizeSlug,\n\t\t} );\n\t}\n\n\tonSelectMediaUploadOption( media ) {\n\t\tconst { id, url } = this.props.attributes;\n\n\t\tconst mediaAttributes = {\n\t\t\tid: media.id,\n\t\t\turl: media.url,\n\t\t\tcaption: media.caption,\n\t\t};\n\n\t\tlet additionalAttributes;\n\t\t// Reset the dimension attributes if changing to a different image.\n\t\tif ( ! media.id || media.id !== id ) {\n\t\t\tadditionalAttributes = {\n\t\t\t\twidth: undefined,\n\t\t\t\theight: undefined,\n\t\t\t\tsizeSlug: DEFAULT_SIZE_SLUG,\n\t\t\t};\n\t\t} else {\n\t\t\t// Keep the same url when selecting the same file, so \"Image Size\" option is not changed.\n\t\t\tadditionalAttributes = { url };\n\t\t}\n\n\t\tthis.props.setAttributes( {\n\t\t\t...mediaAttributes,\n\t\t\t...additionalAttributes,\n\t\t} );\n\t}\n\n\tonFocusCaption() {\n\t\tif ( this.props.onFocus ) {\n\t\t\tthis.props.onFocus();\n\t\t}\n\t\tif ( ! this.state.isCaptionSelected ) {\n\t\t\tthis.setState( {\n\t\t\t\tisCaptionSelected: true,\n\t\t\t} );\n\t\t}\n\t}\n\n\tgetPlaceholderIcon() {\n\t\treturn (\n\t\t\t<Icon\n\t\t\t\ticon={ placeholderIcon }\n\t\t\t\t{ ...this.props.getStylesFromColorScheme(\n\t\t\t\t\tstyles.iconPlaceholder,\n\t\t\t\t\tstyles.iconPlaceholderDark\n\t\t\t\t) }\n\t\t\t/>\n\t\t);\n\t}\n\n\tgetWidth() {\n\t\tconst { attributes } = this.props;\n\t\tconst { align, width } = attributes;\n\n\t\treturn Object.values( WIDE_ALIGNMENTS.alignments ).includes( align )\n\t\t\t? '100%'\n\t\t\t: width;\n\t}\n\n\tgetLinkSettings() {\n\t\tconst { isLinkSheetVisible } = this.state;\n\t\tconst {\n\t\t\tattributes: { href: url, ...unMappedAttributes },\n\t\t\tsetAttributes,\n\t\t} = this.props;\n\n\t\tconst mappedAttributes = { ...unMappedAttributes, url };\n\t\tconst setMappedAttributes = ( { url: href, ...restAttributes } ) =>\n\t\t\thref === undefined\n\t\t\t\t? setAttributes( restAttributes )\n\t\t\t\t: setAttributes( { ...restAttributes, href } );\n\n\t\tconst options = {\n\t\t\turl: {\n\t\t\t\tlabel: __( 'Image Link URL' ),\n\t\t\t\tplaceholder: __( 'Add URL' ),\n\t\t\t\tautoFocus: false,\n\t\t\t\tautoFill: true,\n\t\t\t},\n\t\t\topenInNewTab: {\n\t\t\t\tlabel: __( 'Open in new tab' ),\n\t\t\t},\n\t\t\tlinkRel: {\n\t\t\t\tlabel: __( 'Link Rel' ),\n\t\t\t\tplaceholder: __( 'None' ),\n\t\t\t},\n\t\t};\n\n\t\treturn (\n\t\t\t<LinkSettingsNavigation\n\t\t\t\tisVisible={ isLinkSheetVisible }\n\t\t\t\tattributes={ mappedAttributes }\n\t\t\t\tonClose={ this.dismissSheet }\n\t\t\t\tsetAttributes={ setMappedAttributes }\n\t\t\t\twithBottomSheet={ false }\n\t\t\t\thasPicker\n\t\t\t\toptions={ options }\n\t\t\t\tshowIcon={ false }\n\t\t\t/>\n\t\t);\n\t}\n\n\trender() {\n\t\tconst { isCaptionSelected } = this.state;\n\t\tconst {\n\t\t\tattributes,\n\t\t\tisSelected,\n\t\t\timage,\n\t\t\timageSizes,\n\t\t\tclientId,\n\t\t} = this.props;\n\t\tconst { align, url, alt, id, sizeSlug, className } = attributes;\n\n\t\tconst sizeOptions = map( imageSizes, ( { name, slug } ) => ( {\n\t\t\tvalue: slug,\n\t\t\tname,\n\t\t} ) );\n\t\tconst sizeOptionsValid = find( sizeOptions, [\n\t\t\t'value',\n\t\t\tDEFAULT_SIZE_SLUG,\n\t\t] );\n\n\t\tconst getToolbarEditButton = ( open ) => (\n\t\t\t<BlockControls>\n\t\t\t\t<ToolbarGroup>\n\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\ttitle={ __( 'Edit image' ) }\n\t\t\t\t\t\ticon={ replace }\n\t\t\t\t\t\tonClick={ open }\n\t\t\t\t\t/>\n\t\t\t\t</ToolbarGroup>\n\t\t\t\t<BlockAlignmentToolbar\n\t\t\t\t\tvalue={ align }\n\t\t\t\t\tonChange={ this.updateAlignment }\n\t\t\t\t/>\n\t\t\t</BlockControls>\n\t\t);\n\n\t\tconst getInspectorControls = () => (\n\t\t\t<InspectorControls>\n\t\t\t\t<PanelBody title={ __( 'Image settings' ) } />\n\t\t\t\t<PanelBody style={ styles.panelBody }>\n\t\t\t\t\t<BlockStyles clientId={ clientId } url={ url } />\n\t\t\t\t</PanelBody>\n\t\t\t\t<PanelBody>\n\t\t\t\t\t{ image && sizeOptionsValid && (\n\t\t\t\t\t\t<CycleSelectControl\n\t\t\t\t\t\t\ticon={ expand }\n\t\t\t\t\t\t\tlabel={ __( 'Size' ) }\n\t\t\t\t\t\t\tvalue={ sizeSlug || DEFAULT_SIZE_SLUG }\n\t\t\t\t\t\t\tonChangeValue={ ( newValue ) =>\n\t\t\t\t\t\t\t\tthis.onSetSizeSlug( newValue )\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\toptions={ sizeOptions }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t\t<TextControl\n\t\t\t\t\t\ticon={ textColor }\n\t\t\t\t\t\tlabel={ __( 'Alt Text' ) }\n\t\t\t\t\t\tvalue={ alt || '' }\n\t\t\t\t\t\tvaluePlaceholder={ __( 'None' ) }\n\t\t\t\t\t\tonChangeValue={ this.updateAlt }\n\t\t\t\t\t/>\n\t\t\t\t</PanelBody>\n\t\t\t\t<PanelBody title={ __( 'Link Settings' ) }>\n\t\t\t\t\t{ this.getLinkSettings( true ) }\n\t\t\t\t</PanelBody>\n\t\t\t</InspectorControls>\n\t\t);\n\n\t\tif ( ! url ) {\n\t\t\treturn (\n\t\t\t\t<View style={ styles.content }>\n\t\t\t\t\t<MediaPlaceholder\n\t\t\t\t\t\tallowedTypes={ [ MEDIA_TYPE_IMAGE ] }\n\t\t\t\t\t\tonSelect={ this.onSelectMediaUploadOption }\n\t\t\t\t\t\ticon={ this.getPlaceholderIcon() }\n\t\t\t\t\t\tonFocus={ this.props.onFocus }\n\t\t\t\t\t/>\n\t\t\t\t</View>\n\t\t\t);\n\t\t}\n\n\t\tconst alignToFlex = {\n\t\t\tleft: 'flex-start',\n\t\t\tcenter: 'center',\n\t\t\tright: 'flex-end',\n\t\t\tfull: 'center',\n\t\t\twide: 'center',\n\t\t};\n\n\t\tconst getImageComponent = ( openMediaOptions, getMediaOptions ) => (\n\t\t\t<>\n\t\t\t\t<TouchableWithoutFeedback\n\t\t\t\t\taccessible={ ! isSelected }\n\t\t\t\t\tonPress={ this.onImagePressed }\n\t\t\t\t\tonLongPress={ openMediaOptions }\n\t\t\t\t\tdisabled={ ! isSelected }\n\t\t\t\t>\n\t\t\t\t\t<View style={ styles.content }>\n\t\t\t\t\t\t{ getInspectorControls() }\n\t\t\t\t\t\t{ getMediaOptions() }\n\t\t\t\t\t\t{ ! this.state.isCaptionSelected &&\n\t\t\t\t\t\t\tgetToolbarEditButton( openMediaOptions ) }\n\t\t\t\t\t\t<MediaUploadProgress\n\t\t\t\t\t\t\tcoverUrl={ url }\n\t\t\t\t\t\t\tmediaId={ id }\n\t\t\t\t\t\t\tonUpdateMediaProgress={ this.updateMediaProgress }\n\t\t\t\t\t\t\tonFinishMediaUploadWithSuccess={\n\t\t\t\t\t\t\t\tthis.finishMediaUploadWithSuccess\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonFinishMediaUploadWithFailure={\n\t\t\t\t\t\t\t\tthis.finishMediaUploadWithFailure\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonMediaUploadStateReset={\n\t\t\t\t\t\t\t\tthis.mediaUploadStateReset\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\trenderContent={ ( {\n\t\t\t\t\t\t\t\tisUploadInProgress,\n\t\t\t\t\t\t\t\tisUploadFailed,\n\t\t\t\t\t\t\t\tretryMessage,\n\t\t\t\t\t\t\t} ) => {\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t<Image\n\t\t\t\t\t\t\t\t\t\talign={ align && alignToFlex[ align ] }\n\t\t\t\t\t\t\t\t\t\talt={ alt }\n\t\t\t\t\t\t\t\t\t\tisSelected={\n\t\t\t\t\t\t\t\t\t\t\tisSelected && ! isCaptionSelected\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tisUploadFailed={ isUploadFailed }\n\t\t\t\t\t\t\t\t\t\tisUploadInProgress={\n\t\t\t\t\t\t\t\t\t\t\tisUploadInProgress\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tonSelectMediaUploadOption={\n\t\t\t\t\t\t\t\t\t\t\tthis.onSelectMediaUploadOption\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\topenMediaOptions={ openMediaOptions }\n\t\t\t\t\t\t\t\t\t\tretryMessage={ retryMessage }\n\t\t\t\t\t\t\t\t\t\turl={ url }\n\t\t\t\t\t\t\t\t\t\tshapeStyle={ styles[ className ] }\n\t\t\t\t\t\t\t\t\t\twidth={ this.getWidth() }\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</View>\n\t\t\t\t</TouchableWithoutFeedback>\n\t\t\t\t<BlockCaption\n\t\t\t\t\tclientId={ this.props.clientId }\n\t\t\t\t\tisSelected={ this.state.isCaptionSelected }\n\t\t\t\t\taccessible\n\t\t\t\t\taccessibilityLabelCreator={ this.accessibilityLabelCreator }\n\t\t\t\t\tonFocus={ this.onFocusCaption }\n\t\t\t\t\tonBlur={ this.props.onBlur } // always assign onBlur as props\n\t\t\t\t\tinsertBlocksAfter={ this.props.insertBlocksAfter }\n\t\t\t\t/>\n\t\t\t</>\n\t\t);\n\n\t\treturn (\n\t\t\t<MediaUpload\n\t\t\t\tallowedTypes={ [ MEDIA_TYPE_IMAGE ] }\n\t\t\t\tisReplacingMedia={ true }\n\t\t\t\tonSelect={ this.onSelectMediaUploadOption }\n\t\t\t\trender={ ( { open, getMediaOptions } ) => {\n\t\t\t\t\treturn getImageComponent( open, getMediaOptions );\n\t\t\t\t} }\n\t\t\t/>\n\t\t);\n\t}\n}\n\nexport default compose( [\n\twithSelect( ( select, props ) => {\n\t\tconst { getMedia } = select( 'core' );\n\t\tconst { getSettings } = select( 'core/block-editor' );\n\t\tconst {\n\t\t\tattributes: { id, url },\n\t\t\tisSelected,\n\t\t} = props;\n\t\tconst { imageSizes } = getSettings();\n\t\tconst isNotFileUrl = id && getProtocol( url ) !== 'file:';\n\n\t\tconst shouldGetMedia =\n\t\t\t( isSelected && isNotFileUrl ) ||\n\t\t\t// Edge case to update the image after uploading if the block gets unselected\n\t\t\t// Check if it's the original image and not the resized one with queryparams\n\t\t\t( ! isSelected &&\n\t\t\t\tisNotFileUrl &&\n\t\t\t\turl &&\n\t\t\t\t! hasQueryArg( url, 'w' ) );\n\t\treturn {\n\t\t\timage: shouldGetMedia ? getMedia( id ) : null,\n\t\t\timageSizes,\n\t\t};\n\t} ),\n\twithPreferredColorScheme,\n] )( ImageEdit );\n"]}