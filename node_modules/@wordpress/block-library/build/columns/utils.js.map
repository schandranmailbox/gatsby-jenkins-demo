{"version":3,"sources":["@wordpress/block-library/src/columns/utils.js"],"names":["toWidthPrecision","value","unitlessValue","parseFloat","Number","isFinite","toFixed","undefined","getEffectiveColumnWidth","block","totalBlockCount","attributes","width","getTotalColumnsWidth","blocks","length","getColumnWidths","reduce","accumulator","Object","assign","clientId","getRedistributedColumnWidths","availableWidth","totalWidth","newWidth","hasExplicitPercentColumnWidths","every","blockWidth","endsWith","getMappedColumnWidths","widths","map","getWidths","withParsing","innerColumn","innerColumnWidth","getWidthWithUnit","unit","isPercentageUnit","Math","min","isWeb","Platform","OS","CSS_UNITS","label","default"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { sumBy, merge, mapValues } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { Platform } from '@wordpress/element';\n\n/**\n * Returns a column width attribute value rounded to standard precision.\n * Returns `undefined` if the value is not a valid finite number.\n *\n * @param {?number} value Raw value.\n *\n * @return {number} Value rounded to standard precision.\n */\nexport const toWidthPrecision = ( value ) => {\n\tconst unitlessValue = parseFloat( value );\n\treturn Number.isFinite( unitlessValue )\n\t\t? parseFloat( unitlessValue.toFixed( 2 ) )\n\t\t: undefined;\n};\n/**\n * Returns an effective width for a given block. An effective width is equal to\n * its attribute value if set, or a computed value assuming equal distribution.\n *\n * @param {WPBlock} block           Block object.\n * @param {number}  totalBlockCount Total number of blocks in Columns.\n *\n * @return {number} Effective column width.\n */\nexport function getEffectiveColumnWidth( block, totalBlockCount ) {\n\tconst { width = 100 / totalBlockCount } = block.attributes;\n\treturn toWidthPrecision( width );\n}\n\n/**\n * Returns the total width occupied by the given set of column blocks.\n *\n * @param {WPBlock[]} blocks          Block objects.\n * @param {?number}   totalBlockCount Total number of blocks in Columns.\n *                                    Defaults to number of blocks passed.\n *\n * @return {number} Total width occupied by blocks.\n */\nexport function getTotalColumnsWidth(\n\tblocks,\n\ttotalBlockCount = blocks.length\n) {\n\treturn sumBy( blocks, ( block ) =>\n\t\tgetEffectiveColumnWidth( block, totalBlockCount )\n\t);\n}\n\n/**\n * Returns an object of `clientId` → `width` of effective column widths.\n *\n * @param {WPBlock[]} blocks          Block objects.\n * @param {?number}   totalBlockCount Total number of blocks in Columns.\n *                                    Defaults to number of blocks passed.\n *\n * @return {Object<string,number>} Column widths.\n */\nexport function getColumnWidths( blocks, totalBlockCount = blocks.length ) {\n\treturn blocks.reduce( ( accumulator, block ) => {\n\t\tconst width = getEffectiveColumnWidth( block, totalBlockCount );\n\t\treturn Object.assign( accumulator, { [ block.clientId ]: width } );\n\t}, {} );\n}\n\n/**\n * Returns an object of `clientId` → `width` of column widths as redistributed\n * proportional to their current widths, constrained or expanded to fit within\n * the given available width.\n *\n * @param {WPBlock[]} blocks          Block objects.\n * @param {number}    availableWidth  Maximum width to fit within.\n * @param {?number}   totalBlockCount Total number of blocks in Columns.\n *                                    Defaults to number of blocks passed.\n *\n * @return {Object<string,number>} Redistributed column widths.\n */\nexport function getRedistributedColumnWidths(\n\tblocks,\n\tavailableWidth,\n\ttotalBlockCount = blocks.length\n) {\n\tconst totalWidth = getTotalColumnsWidth( blocks, totalBlockCount );\n\n\treturn mapValues( getColumnWidths( blocks, totalBlockCount ), ( width ) => {\n\t\tconst newWidth = ( availableWidth * width ) / totalWidth;\n\t\treturn toWidthPrecision( newWidth );\n\t} );\n}\n\n/**\n * Returns true if column blocks within the provided set are assigned with\n * explicit widths, or false otherwise.\n *\n * @param {WPBlock[]} blocks Block objects.\n *\n * @return {boolean} Whether columns have explicit widths.\n */\nexport function hasExplicitPercentColumnWidths( blocks ) {\n\treturn blocks.every( ( block ) => {\n\t\tconst blockWidth = block.attributes.width;\n\t\treturn Number.isFinite(\n\t\t\tblockWidth?.endsWith?.( '%' )\n\t\t\t\t? parseFloat( blockWidth )\n\t\t\t\t: blockWidth\n\t\t);\n\t} );\n}\n\n/**\n * Returns a copy of the given set of blocks with new widths assigned from the\n * provided object of redistributed column widths.\n *\n * @param {WPBlock[]}             blocks Block objects.\n * @param {Object<string,number>} widths Redistributed column widths.\n *\n * @return {WPBlock[]} blocks Mapped block objects.\n */\nexport function getMappedColumnWidths( blocks, widths ) {\n\treturn blocks.map( ( block ) =>\n\t\tmerge( {}, block, {\n\t\t\tattributes: {\n\t\t\t\twidth: widths[ block.clientId ],\n\t\t\t},\n\t\t} )\n\t);\n}\n\n/**\n * Returns an array with columns widths values, parsed or no depends on `withParsing` flag.\n *\n * @param {WPBlock[]} blocks\t\t\tBlock objects.\n * @param {?boolean} withParsing \tWhether value has to be parsed.\n *\n * @return {Array<number,string>} Column widths.\n */\nexport function getWidths( blocks, withParsing = true ) {\n\treturn blocks.map( ( innerColumn ) => {\n\t\tconst innerColumnWidth =\n\t\t\tinnerColumn.attributes.width || 100 / blocks.length;\n\n\t\treturn withParsing ? parseFloat( innerColumnWidth ) : innerColumnWidth;\n\t} );\n}\n\n/**\n * Returns a column width with unit.\n *\n * @param {string} width\tColumn width.\n * @param {string} unit \tColumn width unit.\n *\n * @return {string} Column width with unit.\n */\nexport function getWidthWithUnit( width, unit ) {\n\twidth = 0 > parseFloat( width ) ? '0' : width;\n\n\tif ( isPercentageUnit( unit ) ) {\n\t\twidth = Math.min( width, 100 );\n\t}\n\n\treturn `${ width }${ unit }`;\n}\n\nconst isWeb = Platform.OS === 'web';\n\nexport const CSS_UNITS = [\n\t{\n\t\tvalue: '%',\n\t\tlabel: isWeb ? '%' : __( 'Percentage (%)' ),\n\t\tdefault: '',\n\t},\n\t{\n\t\tvalue: 'px',\n\t\tlabel: isWeb ? 'px' : __( 'Pixels (px)' ),\n\t\tdefault: '',\n\t},\n\t{\n\t\tvalue: 'em',\n\t\tlabel: isWeb ? 'em' : __( 'Relative to parent font size (em)' ),\n\t\tdefault: '',\n\t},\n\t{\n\t\tvalue: 'rem',\n\t\tlabel: isWeb ? 'rem' : __( 'Relative to root font size (rem)' ),\n\t\tdefault: '',\n\t},\n\t{\n\t\tvalue: 'vw',\n\t\tlabel: isWeb ? 'vw' : __( 'Viewport width (vw)' ),\n\t\tdefault: '',\n\t},\n];\n\n/**\n * Returns a boolean whether passed unit is percentage\n *\n * @param {string} unit Column width unit.\n *\n * @return {boolean} \tWhether unit is '%'.\n */\nexport function isPercentageUnit( unit ) {\n\treturn unit === '%';\n}\n"]}