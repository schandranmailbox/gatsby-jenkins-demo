{"version":3,"sources":["@wordpress/block-library/src/template-part/edit/selection/template-part-previews.js"],"names":["PreviewPlaceholder","TemplatePartItem","templatePart","setAttributes","onClose","composite","slug","theme","title","rendered","content","raw","blocks","noticesStore","createSuccessNotice","onClick","type","event","ENTER","keyCode","SPACE","PanelGroup","icon","children","TemplatePartsByTheme","templateParts","templatePartsByTheme","Object","values","currentShownTPs","map","templatePartList","includes","id","TemplatePartSearchResults","filterValue","filteredTPs","normalizedFilterValue","toLowerCase","searchResults","filter","sort","a","b","indexInSlugA","indexOf","indexInSlugB","TemplatePartPreviews","select","getEntityRecords","length"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { groupBy, deburr } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport { parse } from '@wordpress/blocks';\nimport { useMemo, useCallback } from '@wordpress/element';\nimport { ENTER, SPACE } from '@wordpress/keycodes';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { BlockPreview } from '@wordpress/block-editor';\nimport {\n\t__unstableComposite as Composite,\n\t__unstableCompositeItem as CompositeItem,\n\tIcon,\n\t__unstableUseCompositeState as useCompositeState,\n} from '@wordpress/components';\nimport { useAsyncList } from '@wordpress/compose';\nimport { store as noticesStore } from '@wordpress/notices';\n\nfunction PreviewPlaceholder() {\n\treturn (\n\t\t<div\n\t\t\tclassName=\"wp-block-template-part__selection-preview-item is-placeholder\"\n\t\t\ttabIndex={ 0 }\n\t\t/>\n\t);\n}\n\nfunction TemplatePartItem( {\n\ttemplatePart,\n\tsetAttributes,\n\tonClose,\n\tcomposite,\n} ) {\n\tconst {\n\t\tslug,\n\t\ttheme,\n\t\ttitle: { rendered: title },\n\t} = templatePart;\n\t// The 'raw' property is not defined for a brief period in the save cycle.\n\t// The fallback prevents an error in the parse function while saving.\n\tconst content = templatePart.content.raw || '';\n\tconst blocks = useMemo( () => parse( content ), [ content ] );\n\tconst { createSuccessNotice } = useDispatch( noticesStore );\n\n\tconst onClick = useCallback( () => {\n\t\tsetAttributes( { slug, theme } );\n\t\tcreateSuccessNotice(\n\t\t\tsprintf(\n\t\t\t\t/* translators: %s: template part title. */\n\t\t\t\t__( 'Template Part \"%s\" inserted.' ),\n\t\t\t\ttitle || slug\n\t\t\t),\n\t\t\t{\n\t\t\t\ttype: 'snackbar',\n\t\t\t}\n\t\t);\n\t\tonClose();\n\t}, [ slug, theme ] );\n\n\treturn (\n\t\t<CompositeItem\n\t\t\tas=\"div\"\n\t\t\tclassName=\"wp-block-template-part__selection-preview-item\"\n\t\t\trole=\"option\"\n\t\t\tonClick={ onClick }\n\t\t\tonKeyDown={ ( event ) => {\n\t\t\t\tif ( ENTER === event.keyCode || SPACE === event.keyCode ) {\n\t\t\t\t\tonClick();\n\t\t\t\t}\n\t\t\t} }\n\t\t\ttabIndex={ 0 }\n\t\t\taria-label={ title || slug }\n\t\t\t{ ...composite }\n\t\t>\n\t\t\t<BlockPreview blocks={ blocks } />\n\t\t\t<div className=\"wp-block-template-part__selection-preview-item-title\">\n\t\t\t\t{ title || slug }\n\t\t\t</div>\n\t\t</CompositeItem>\n\t);\n}\n\nfunction PanelGroup( { title, icon, children } ) {\n\treturn (\n\t\t<>\n\t\t\t<div className=\"wp-block-template-part__selection-panel-group-header\">\n\t\t\t\t<span className=\"wp-block-template-part__selection-panel-group-title\">\n\t\t\t\t\t{ title }\n\t\t\t\t</span>\n\t\t\t\t<Icon icon={ icon } />\n\t\t\t</div>\n\t\t\t<div className=\"wp-block-template-part__selection-panel-group-content\">\n\t\t\t\t{ children }\n\t\t\t</div>\n\t\t</>\n\t);\n}\n\nfunction TemplatePartsByTheme( {\n\ttemplateParts,\n\tsetAttributes,\n\tonClose,\n\tcomposite,\n} ) {\n\tconst templatePartsByTheme = useMemo( () => {\n\t\treturn Object.values( groupBy( templateParts, 'theme' ) );\n\t}, [ templateParts ] );\n\tconst currentShownTPs = useAsyncList( templateParts );\n\n\treturn templatePartsByTheme.map( ( templatePartList ) => (\n\t\t<PanelGroup key={ templatePartList[ 0 ].theme }>\n\t\t\t{ templatePartList.map( ( templatePart ) => {\n\t\t\t\treturn currentShownTPs.includes( templatePart ) ? (\n\t\t\t\t\t<TemplatePartItem\n\t\t\t\t\t\tkey={ templatePart.id }\n\t\t\t\t\t\ttemplatePart={ templatePart }\n\t\t\t\t\t\tsetAttributes={ setAttributes }\n\t\t\t\t\t\tonClose={ onClose }\n\t\t\t\t\t\tcomposite={ composite }\n\t\t\t\t\t/>\n\t\t\t\t) : (\n\t\t\t\t\t<PreviewPlaceholder key={ templatePart.id } />\n\t\t\t\t);\n\t\t\t} ) }\n\t\t</PanelGroup>\n\t) );\n}\n\nfunction TemplatePartSearchResults( {\n\ttemplateParts,\n\tsetAttributes,\n\tfilterValue,\n\tonClose,\n\tcomposite,\n} ) {\n\tconst filteredTPs = useMemo( () => {\n\t\t// Filter based on value.\n\t\t// Remove diacritics and convert to lowercase to normalize.\n\t\tconst normalizedFilterValue = deburr( filterValue ).toLowerCase();\n\t\tconst searchResults = templateParts.filter(\n\t\t\t( { slug, theme } ) =>\n\t\t\t\tslug.toLowerCase().includes( normalizedFilterValue ) ||\n\t\t\t\t// Since diacritics can be used in theme names, remove them for the comparison.\n\t\t\t\tdeburr( theme ).toLowerCase().includes( normalizedFilterValue )\n\t\t);\n\t\t// Order based on value location.\n\t\tsearchResults.sort( ( a, b ) => {\n\t\t\t// First prioritize index found in slug.\n\t\t\tconst indexInSlugA = a.slug\n\t\t\t\t.toLowerCase()\n\t\t\t\t.indexOf( normalizedFilterValue );\n\t\t\tconst indexInSlugB = b.slug\n\t\t\t\t.toLowerCase()\n\t\t\t\t.indexOf( normalizedFilterValue );\n\t\t\tif ( indexInSlugA !== -1 && indexInSlugB !== -1 ) {\n\t\t\t\treturn indexInSlugA - indexInSlugB;\n\t\t\t} else if ( indexInSlugA !== -1 ) {\n\t\t\t\treturn -1;\n\t\t\t} else if ( indexInSlugB !== -1 ) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\t// Second prioritize index found in theme.\n\t\t\t// Since diacritics can be used in theme names, remove them for the comparison.\n\t\t\treturn (\n\t\t\t\tdeburr( a.theme )\n\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t.indexOf( normalizedFilterValue ) -\n\t\t\t\tdeburr( b.theme ).toLowerCase().indexOf( normalizedFilterValue )\n\t\t\t);\n\t\t} );\n\t\treturn searchResults;\n\t}, [ filterValue, templateParts ] );\n\n\tconst currentShownTPs = useAsyncList( filteredTPs );\n\n\treturn filteredTPs.map( ( templatePart ) => (\n\t\t<PanelGroup\n\t\t\tkey={ templatePart.id }\n\t\t\ttitle={ templatePart.theme || __( 'Custom' ) }\n\t\t>\n\t\t\t{ currentShownTPs.includes( templatePart ) ? (\n\t\t\t\t<TemplatePartItem\n\t\t\t\t\tkey={ templatePart.id }\n\t\t\t\t\ttemplatePart={ templatePart }\n\t\t\t\t\tsetAttributes={ setAttributes }\n\t\t\t\t\tonClose={ onClose }\n\t\t\t\t\tcomposite={ composite }\n\t\t\t\t/>\n\t\t\t) : (\n\t\t\t\t<PreviewPlaceholder key={ templatePart.id } />\n\t\t\t) }\n\t\t</PanelGroup>\n\t) );\n}\n\nexport default function TemplatePartPreviews( {\n\tsetAttributes,\n\tfilterValue,\n\tonClose,\n} ) {\n\tconst composite = useCompositeState();\n\tconst templateParts = useSelect( ( select ) => {\n\t\treturn (\n\t\t\tselect( 'core' ).getEntityRecords(\n\t\t\t\t'postType',\n\t\t\t\t'wp_template_part'\n\t\t\t) || []\n\t\t);\n\t}, [] );\n\n\tif ( ! templateParts || ! templateParts.length ) {\n\t\treturn null;\n\t}\n\n\tif ( filterValue ) {\n\t\treturn (\n\t\t\t<Composite\n\t\t\t\t{ ...composite }\n\t\t\t\trole=\"listbox\"\n\t\t\t\taria-label={ __( 'List of template parts' ) }\n\t\t\t>\n\t\t\t\t<TemplatePartSearchResults\n\t\t\t\t\ttemplateParts={ templateParts }\n\t\t\t\t\tsetAttributes={ setAttributes }\n\t\t\t\t\tfilterValue={ filterValue }\n\t\t\t\t\tonClose={ onClose }\n\t\t\t\t\tcomposite={ composite }\n\t\t\t\t/>\n\t\t\t</Composite>\n\t\t);\n\t}\n\n\treturn (\n\t\t<Composite\n\t\t\t{ ...composite }\n\t\t\trole=\"listbox\"\n\t\t\taria-label={ __( 'List of template parts' ) }\n\t\t>\n\t\t\t<TemplatePartsByTheme\n\t\t\t\ttemplateParts={ templateParts }\n\t\t\t\tsetAttributes={ setAttributes }\n\t\t\t\tonClose={ onClose }\n\t\t\t\tcomposite={ composite }\n\t\t\t/>\n\t\t</Composite>\n\t);\n}\n"]}