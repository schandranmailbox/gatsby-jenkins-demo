{"version":3,"sources":["@wordpress/block-library/src/audio/edit.native.js"],"names":["ALLOWED_MEDIA_TYPES","AudioEdit","attributes","noticeOperations","setAttributes","isSelected","noticeUI","insertBlocksAfter","onFocus","onBlur","clientId","id","autoplay","loop","preload","src","isCaptionSelected","setIsCaptionSelected","onFileChange","mediaId","mediaUrl","onError","onUploadError","toggleAttribute","attribute","newValue","onSelectURL","message","removeAllNotices","createErrorNotice","onSelectAudio","media","url","undefined","onAudioPress","onFocusCaption","icon","getBlockControls","open","replace","getBlockUI","getMediaOptions","updateMediaProgress","isUploadInProgress","isUploadFailed","value","label","caption"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { Text, TouchableWithoutFeedback } from 'react-native';\nimport { isEmpty } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { View } from '@wordpress/primitives';\nimport {\n\tPanelBody,\n\tSelectControl,\n\tToggleControl,\n\twithNotices,\n\tToolbarButton,\n\tToolbarGroup,\n} from '@wordpress/components';\nimport {\n\tBlockCaption,\n\tBlockControls,\n\tBlockIcon,\n\tInspectorControls,\n\tMediaPlaceholder,\n\tMediaUpload,\n\tMediaUploadProgress,\n} from '@wordpress/block-editor';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { audio as icon, replace } from '@wordpress/icons';\nimport { useState } from '@wordpress/element';\n\nconst ALLOWED_MEDIA_TYPES = [ 'audio' ];\n\nfunction AudioEdit( {\n\tattributes,\n\tnoticeOperations,\n\tsetAttributes,\n\tisSelected,\n\tnoticeUI,\n\tinsertBlocksAfter,\n\tonFocus,\n\tonBlur,\n\tclientId,\n} ) {\n\tconst { id, autoplay, loop, preload, src } = attributes;\n\n\tconst [ isCaptionSelected, setIsCaptionSelected ] = useState( false );\n\n\tconst onFileChange = ( { mediaId, mediaUrl } ) => {\n\t\tsetAttributes( { id: mediaId, src: mediaUrl } );\n\t};\n\n\tconst onError = () => {\n\t\t// TODO: Set up error state\n\t\tonUploadError( __( 'Error' ) );\n\t};\n\n\tfunction toggleAttribute( attribute ) {\n\t\treturn ( newValue ) => {\n\t\t\tsetAttributes( { [ attribute ]: newValue } );\n\t\t};\n\t}\n\n\tfunction onSelectURL() {\n\t\t// TODO: Set up add audio from URL flow\n\t}\n\n\tfunction onUploadError( message ) {\n\t\tnoticeOperations.removeAllNotices();\n\t\tnoticeOperations.createErrorNotice( message );\n\t}\n\n\t// const { setAttributes, isSelected, noticeUI } = this.props;\n\tfunction onSelectAudio( media ) {\n\t\tif ( ! media || ! media.url ) {\n\t\t\t// in this case there was an error and we should continue in the editing state\n\t\t\t// previous attributes should be removed because they may be temporary blob urls\n\t\t\tsetAttributes( { src: undefined, id: undefined } );\n\t\t\treturn;\n\t\t}\n\t\t// sets the block's attribute and updates the edit component from the\n\t\t// selected media, then switches off the editing UI\n\t\tsetAttributes( { src: media.url, id: media.id } );\n\t}\n\n\tfunction onAudioPress() {\n\t\tsetIsCaptionSelected( false );\n\t}\n\n\tfunction onFocusCaption() {\n\t\tif ( ! isCaptionSelected ) {\n\t\t\tsetIsCaptionSelected( true );\n\t\t}\n\t}\n\n\tif ( ! src ) {\n\t\treturn (\n\t\t\t<View>\n\t\t\t\t<MediaPlaceholder\n\t\t\t\t\ticon={ <BlockIcon icon={ icon } /> }\n\t\t\t\t\tonSelect={ onSelectAudio }\n\t\t\t\t\tonSelectURL={ onSelectURL }\n\t\t\t\t\taccept=\"audio/*\"\n\t\t\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\n\t\t\t\t\tvalue={ attributes }\n\t\t\t\t\tnotices={ noticeUI }\n\t\t\t\t\tonError={ onUploadError }\n\t\t\t\t\tonFocus={ onFocus }\n\t\t\t\t/>\n\t\t\t</View>\n\t\t);\n\t}\n\n\tfunction getBlockControls( open ) {\n\t\treturn (\n\t\t\t<BlockControls>\n\t\t\t\t<ToolbarGroup>\n\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\ttitle={ __( 'Replace audio' ) }\n\t\t\t\t\t\ticon={ replace }\n\t\t\t\t\t\tonClick={ open }\n\t\t\t\t\t/>\n\t\t\t\t</ToolbarGroup>\n\t\t\t</BlockControls>\n\t\t);\n\t}\n\n\tfunction getBlockUI( open, getMediaOptions ) {\n\t\treturn (\n\t\t\t<MediaUploadProgress\n\t\t\t\tmediaId={ id }\n\t\t\t\tonUpdateMediaProgress={ this.updateMediaProgress }\n\t\t\t\tonFinishMediaUploadWithSuccess={ onFileChange }\n\t\t\t\tonFinishMediaUploadWithFailure={ onError }\n\t\t\t\tonMediaUploadStateReset={ onFileChange }\n\t\t\t\trenderContent={ ( { isUploadInProgress, isUploadFailed } ) => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<View>\n\t\t\t\t\t\t\t{ ! isCaptionSelected && getBlockControls( open ) }\n\t\t\t\t\t\t\t{ getMediaOptions() }\n\t\t\t\t\t\t\t<Text>\n\t\t\t\t\t\t\t\t‚èØ Audio Player goes here.{ ' ' }\n\t\t\t\t\t\t\t\t{ isUploadInProgress && 'Uploading...' }\n\t\t\t\t\t\t\t\t{ isUploadFailed && 'ERROR' }\n\t\t\t\t\t\t\t</Text>\n\t\t\t\t\t\t</View>\n\t\t\t\t\t);\n\t\t\t\t} }\n\t\t\t/>\n\t\t);\n\t}\n\n\treturn (\n\t\t<TouchableWithoutFeedback\n\t\t\taccessible={ ! isSelected }\n\t\t\tonPress={ onAudioPress }\n\t\t\tdisabled={ ! isSelected }\n\t\t>\n\t\t\t<View>\n\t\t\t\t<InspectorControls>\n\t\t\t\t\t<PanelBody title={ __( 'Audio settings' ) }>\n\t\t\t\t\t\t<ToggleControl\n\t\t\t\t\t\t\tlabel={ __( 'Autoplay' ) }\n\t\t\t\t\t\t\tonChange={ toggleAttribute( 'autoplay' ) }\n\t\t\t\t\t\t\tchecked={ autoplay }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<ToggleControl\n\t\t\t\t\t\t\tlabel={ __( 'Loop' ) }\n\t\t\t\t\t\t\tonChange={ toggleAttribute( 'loop' ) }\n\t\t\t\t\t\t\tchecked={ loop }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<SelectControl\n\t\t\t\t\t\t\tlabel={ __( 'Preload' ) }\n\t\t\t\t\t\t\tvalue={ preload || '' }\n\t\t\t\t\t\t\t// `undefined` is required for the preload attribute to be unset.\n\t\t\t\t\t\t\tonChange={ ( value ) =>\n\t\t\t\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t\t\t\tpreload: value || undefined,\n\t\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\toptions={ [\n\t\t\t\t\t\t\t\t{ value: '', label: __( 'Browser default' ) },\n\t\t\t\t\t\t\t\t{ value: 'auto', label: __( 'Auto' ) },\n\t\t\t\t\t\t\t\t{ value: 'metadata', label: __( 'Metadata' ) },\n\t\t\t\t\t\t\t\t{ value: 'none', label: __( 'None' ) },\n\t\t\t\t\t\t\t] }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</PanelBody>\n\t\t\t\t</InspectorControls>\n\t\t\t\t<MediaUpload\n\t\t\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\n\t\t\t\t\tisReplacingMedia={ true }\n\t\t\t\t\tonSelect={ onSelectAudio }\n\t\t\t\t\trender={ ( { open, getMediaOptions } ) => {\n\t\t\t\t\t\treturn getBlockUI( open, getMediaOptions );\n\t\t\t\t\t} }\n\t\t\t\t/>\n\t\t\t\t<BlockCaption\n\t\t\t\t\taccessible={ true }\n\t\t\t\t\taccessibilityLabelCreator={ ( caption ) =>\n\t\t\t\t\t\tisEmpty( caption )\n\t\t\t\t\t\t\t? /* translators: accessibility text. Empty Audio caption. */\n\t\t\t\t\t\t\t  __( 'Audio caption. Empty' )\n\t\t\t\t\t\t\t: sprintf(\n\t\t\t\t\t\t\t\t\t/* translators: accessibility text. %s: Audio caption. */\n\t\t\t\t\t\t\t\t\t__( 'Audio caption. %s' ),\n\t\t\t\t\t\t\t\t\tcaption\n\t\t\t\t\t\t\t  )\n\t\t\t\t\t}\n\t\t\t\t\tclientId={ clientId }\n\t\t\t\t\tisSelected={ isCaptionSelected }\n\t\t\t\t\tonFocus={ onFocusCaption }\n\t\t\t\t\tonBlur={ onBlur }\n\t\t\t\t\tinsertBlocksAfter={ insertBlocksAfter }\n\t\t\t\t/>\n\t\t\t</View>\n\t\t</TouchableWithoutFeedback>\n\t);\n}\nexport default withNotices( AudioEdit );\n"]}