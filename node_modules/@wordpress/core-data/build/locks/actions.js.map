{"version":3,"sources":["@wordpress/core-data/src/locks/actions.js"],"names":["__unstableAcquireStoreLock","__unstableEnqueueLockRequest","__unstableReleaseStoreLock","__unstableProcessPendingLockRequests","store","path","exclusive","promise","Promise","resolve","notifyAcquired","type","request","lock","controls","select","lockRequests","isAvailable"],"mappings":";;;;;;;;;;;;;;AAGA;;AACA;;;;;;;;qDAEiBA,0B;sDAQAC,4B;sDAYAC,0B;sDAQAC,oC;;AA5BV,SAAUH,0BAAV,CAAsCI,KAAtC,EAA6CC,IAA7C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAqDC,UAAAA,SAArD,QAAqDA,SAArD;AACU,wCAAOL,4BAA4B,CAAEG,KAAF,EAASC,IAAT,EAAe;AACjEC,YAAAA,SAAS,EAATA;AADiE,WAAf,CAAnC;;AADV;AACAC,UAAAA,OADA;AAIN,wCAAOJ,oCAAoC,EAA3C;;AAJM;AAAA;AAKC,iBAAM,0CAAwBI,OAAxB,CAAN;;AALD;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAQA,SAAUN,4BAAV,CAAwCG,KAAxC,EAA+CC,IAA/C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAuDC,UAAAA,SAAvD,SAAuDA,SAAvD;AAEAC,UAAAA,OAFA,GAEU,IAAIC,OAAJ,CAAa,UAAEC,OAAF,EAAe;AAC3CC,YAAAA,cAAc,GAAGD,OAAjB;AACA,WAFe,CAFV;AAAA;AAKN,iBAAM;AACLE,YAAAA,IAAI,EAAE,sBADD;AAELC,YAAAA,OAAO,EAAE;AAAER,cAAAA,KAAK,EAALA,KAAF;AAASC,cAAAA,IAAI,EAAJA,IAAT;AAAeC,cAAAA,SAAS,EAATA,SAAf;AAA0BI,cAAAA,cAAc,EAAdA;AAA1B;AAFJ,WAAN;;AALM;AAAA,4CASCH,OATD;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAYA,SAAUL,0BAAV,CAAsCW,IAAtC;AAAA;AAAA;AAAA;AAAA;AAAA;AACN,iBAAM;AACLF,YAAAA,IAAI,EAAE,cADD;AAELE,YAAAA,IAAI,EAAJA;AAFK,WAAN;;AADM;AAKN,yCAAOV,oCAAoC,EAA3C;;AALM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAQA,SAAUA,oCAAV;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AACN,iBAAM;AACLQ,YAAAA,IAAI,EAAE;AADD,WAAN;;AADM;AAAA;AAIe,iBAAMG,eAASC,MAAT,CAC1B,MAD0B,EAE1B,kCAF0B,CAAN;;AAJf;AAIAC,UAAAA,YAJA;AAAA,iDAQiBA,YARjB;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAQMJ,UAAAA,OARN;AASGR,UAAAA,KATH,GAS8CQ,OAT9C,CASGR,KATH,EASUC,IATV,GAS8CO,OAT9C,CASUP,IATV,EASgBC,SAThB,GAS8CM,OAT9C,CASgBN,SAThB,EAS2BI,cAT3B,GAS8CE,OAT9C,CAS2BF,cAT3B;AAAA;AAUe,iBAAMI,eAASC,MAAT,CACzB,MADyB,EAEzB,2BAFyB,EAGzBX,KAHyB,EAIzBC,IAJyB,EAKzB;AACCC,YAAAA,SAAS,EAATA;AADD,WALyB,CAAN;;AAVf;AAUCW,UAAAA,WAVD;;AAAA,eAmBAA,WAnBA;AAAA;AAAA;AAAA;;AAoBEJ,UAAAA,IApBF,GAoBS;AAAET,YAAAA,KAAK,EAALA,KAAF;AAASC,YAAAA,IAAI,EAAJA,IAAT;AAAeC,YAAAA,SAAS,EAATA;AAAf,WApBT;AAAA;AAqBJ,iBAAM;AACLK,YAAAA,IAAI,EAAE,oBADD;AAELE,YAAAA,IAAI,EAAJA,IAFK;AAGLD,YAAAA,OAAO,EAAPA;AAHK,WAAN;;AArBI;AA0BJF,UAAAA,cAAc,CAAEG,IAAF,CAAd;;AA1BI;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { __unstableAwaitPromise } from '@wordpress/data-controls';\nimport { controls } from '@wordpress/data';\n\nexport function* __unstableAcquireStoreLock( store, path, { exclusive } ) {\n\tconst promise = yield* __unstableEnqueueLockRequest( store, path, {\n\t\texclusive,\n\t} );\n\tyield* __unstableProcessPendingLockRequests();\n\treturn yield __unstableAwaitPromise( promise );\n}\n\nexport function* __unstableEnqueueLockRequest( store, path, { exclusive } ) {\n\tlet notifyAcquired;\n\tconst promise = new Promise( ( resolve ) => {\n\t\tnotifyAcquired = resolve;\n\t} );\n\tyield {\n\t\ttype: 'ENQUEUE_LOCK_REQUEST',\n\t\trequest: { store, path, exclusive, notifyAcquired },\n\t};\n\treturn promise;\n}\n\nexport function* __unstableReleaseStoreLock( lock ) {\n\tyield {\n\t\ttype: 'RELEASE_LOCK',\n\t\tlock,\n\t};\n\tyield* __unstableProcessPendingLockRequests();\n}\n\nexport function* __unstableProcessPendingLockRequests() {\n\tyield {\n\t\ttype: 'PROCESS_PENDING_LOCK_REQUESTS',\n\t};\n\tconst lockRequests = yield controls.select(\n\t\t'core',\n\t\t'__unstableGetPendingLockRequests'\n\t);\n\tfor ( const request of lockRequests ) {\n\t\tconst { store, path, exclusive, notifyAcquired } = request;\n\t\tconst isAvailable = yield controls.select(\n\t\t\t'core',\n\t\t\t'__unstableIsLockAvailable',\n\t\t\tstore,\n\t\t\tpath,\n\t\t\t{\n\t\t\t\texclusive,\n\t\t\t}\n\t\t);\n\t\tif ( isAvailable ) {\n\t\t\tconst lock = { store, path, exclusive };\n\t\t\tyield {\n\t\t\t\ttype: 'GRANT_LOCK_REQUEST',\n\t\t\t\tlock,\n\t\t\t\trequest,\n\t\t\t};\n\t\t\tnotifyAcquired( lock );\n\t\t}\n\t}\n}\n"]}