{"version":3,"sources":["@wordpress/core-data/src/reducer.js"],"names":["terms","state","action","type","taxonomy","users","byId","queries","queryID","user","id","currentUser","taxonomies","currentTheme","undefined","stylesheet","themes","themeSupports","entity","entityConfig","name","kind","key","DEFAULT_ENTITY_KEY","queriedData","queriedDataReducer","edits","nextState","items","record","recordId","nextEdits","Object","keys","reduce","acc","persistedEdits","length","forEach","saving","pending","error","isAutosave","deleting","entitiesConfig","defaultEntities","entities","newConfig","config","entitiesDataReducer","reducer","entitiesByKind","entries","memo","subEntities","kindReducer","kindMemo","newData","data","UNDO_INITIAL_STATE","offset","lastEditAction","undo","isCreateUndoLevel","isUndoOrRedo","meta","isUndo","isRedo","some","transientEdits","flattenedUndo","slice","pop","push","comparisonUndoEdits","values","filter","edit","comparisonEdits","embedPreviews","url","preview","userPermissions","isAllowed","autosaves","postId","autosavesData","locks","locksReducer"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { keyBy, map, groupBy, flowRight, isEqual, get } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { combineReducers } from '@wordpress/data';\nimport isShallowEqual from '@wordpress/is-shallow-equal';\n\n/**\n * Internal dependencies\n */\nimport { ifMatchingAction, replaceAction } from './utils';\nimport { reducer as queriedDataReducer } from './queried-data';\nimport { defaultEntities, DEFAULT_ENTITY_KEY } from './entities';\nimport { reducer as locksReducer } from './locks';\n\n/**\n * Reducer managing terms state. Keyed by taxonomy slug, the value is either\n * undefined (if no request has been made for given taxonomy), null (if a\n * request is in-flight for given taxonomy), or the array of terms for the\n * taxonomy.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function terms( state = {}, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'RECEIVE_TERMS':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t[ action.taxonomy ]: action.terms,\n\t\t\t};\n\t}\n\n\treturn state;\n}\n\n/**\n * Reducer managing authors state. Keyed by id.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function users( state = { byId: {}, queries: {} }, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'RECEIVE_USER_QUERY':\n\t\t\treturn {\n\t\t\t\tbyId: {\n\t\t\t\t\t...state.byId,\n\t\t\t\t\t...keyBy( action.users, 'id' ),\n\t\t\t\t},\n\t\t\t\tqueries: {\n\t\t\t\t\t...state.queries,\n\t\t\t\t\t[ action.queryID ]: map(\n\t\t\t\t\t\taction.users,\n\t\t\t\t\t\t( user ) => user.id\n\t\t\t\t\t),\n\t\t\t\t},\n\t\t\t};\n\t}\n\n\treturn state;\n}\n\n/**\n * Reducer managing current user state.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function currentUser( state = {}, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'RECEIVE_CURRENT_USER':\n\t\t\treturn action.currentUser;\n\t}\n\n\treturn state;\n}\n\n/**\n * Reducer managing taxonomies.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function taxonomies( state = [], action ) {\n\tswitch ( action.type ) {\n\t\tcase 'RECEIVE_TAXONOMIES':\n\t\t\treturn action.taxonomies;\n\t}\n\n\treturn state;\n}\n\n/**\n * Reducer managing the current theme.\n *\n * @param {string} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {string} Updated state.\n */\nexport function currentTheme( state = undefined, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'RECEIVE_CURRENT_THEME':\n\t\t\treturn action.currentTheme.stylesheet;\n\t}\n\n\treturn state;\n}\n\n/**\n * Reducer managing installed themes.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function themes( state = {}, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'RECEIVE_CURRENT_THEME':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t[ action.currentTheme.stylesheet ]: action.currentTheme,\n\t\t\t};\n\t}\n\n\treturn state;\n}\n\n/**\n * Reducer managing theme supports data.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function themeSupports( state = {}, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'RECEIVE_THEME_SUPPORTS':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t...action.themeSupports,\n\t\t\t};\n\t}\n\n\treturn state;\n}\n\n/**\n * Higher Order Reducer for a given entity config. It supports:\n *\n *  - Fetching\n *  - Editing\n *  - Saving\n *\n * @param {Object} entityConfig  Entity config.\n *\n * @return {Function} Reducer.\n */\nfunction entity( entityConfig ) {\n\treturn flowRight( [\n\t\t// Limit to matching action type so we don't attempt to replace action on\n\t\t// an unhandled action.\n\t\tifMatchingAction(\n\t\t\t( action ) =>\n\t\t\t\taction.name &&\n\t\t\t\taction.kind &&\n\t\t\t\taction.name === entityConfig.name &&\n\t\t\t\taction.kind === entityConfig.kind\n\t\t),\n\n\t\t// Inject the entity config into the action.\n\t\treplaceAction( ( action ) => {\n\t\t\treturn {\n\t\t\t\t...action,\n\t\t\t\tkey: entityConfig.key || DEFAULT_ENTITY_KEY,\n\t\t\t};\n\t\t} ),\n\t] )(\n\t\tcombineReducers( {\n\t\t\tqueriedData: queriedDataReducer,\n\n\t\t\tedits: ( state = {}, action ) => {\n\t\t\t\tswitch ( action.type ) {\n\t\t\t\t\tcase 'RECEIVE_ITEMS':\n\t\t\t\t\t\tconst nextState = { ...state };\n\n\t\t\t\t\t\tfor ( const record of action.items ) {\n\t\t\t\t\t\t\tconst recordId = record[ action.key ];\n\t\t\t\t\t\t\tconst edits = nextState[ recordId ];\n\t\t\t\t\t\t\tif ( ! edits ) {\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst nextEdits = Object.keys( edits ).reduce(\n\t\t\t\t\t\t\t\t( acc, key ) => {\n\t\t\t\t\t\t\t\t\t// If the edited value is still different to the persisted value,\n\t\t\t\t\t\t\t\t\t// keep the edited value in edits.\n\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\t// Edits are the \"raw\" attribute values, but records may have\n\t\t\t\t\t\t\t\t\t\t// objects with more properties, so we use `get` here for the\n\t\t\t\t\t\t\t\t\t\t// comparison.\n\t\t\t\t\t\t\t\t\t\t! isEqual(\n\t\t\t\t\t\t\t\t\t\t\tedits[ key ],\n\t\t\t\t\t\t\t\t\t\t\tget(\n\t\t\t\t\t\t\t\t\t\t\t\trecord[ key ],\n\t\t\t\t\t\t\t\t\t\t\t\t'raw',\n\t\t\t\t\t\t\t\t\t\t\t\trecord[ key ]\n\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t) &&\n\t\t\t\t\t\t\t\t\t\t// Sometimes the server alters the sent value which means\n\t\t\t\t\t\t\t\t\t\t// we need to also remove the edits before the api request.\n\t\t\t\t\t\t\t\t\t\t( ! action.persistedEdits ||\n\t\t\t\t\t\t\t\t\t\t\t! isEqual(\n\t\t\t\t\t\t\t\t\t\t\t\tedits[ key ],\n\t\t\t\t\t\t\t\t\t\t\t\taction.persistedEdits[ key ]\n\t\t\t\t\t\t\t\t\t\t\t) )\n\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\tacc[ key ] = edits[ key ];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\treturn acc;\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{}\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tif ( Object.keys( nextEdits ).length ) {\n\t\t\t\t\t\t\t\tnextState[ recordId ] = nextEdits;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdelete nextState[ recordId ];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn nextState;\n\n\t\t\t\t\tcase 'EDIT_ENTITY_RECORD':\n\t\t\t\t\t\tconst nextEdits = {\n\t\t\t\t\t\t\t...state[ action.recordId ],\n\t\t\t\t\t\t\t...action.edits,\n\t\t\t\t\t\t};\n\t\t\t\t\t\tObject.keys( nextEdits ).forEach( ( key ) => {\n\t\t\t\t\t\t\t// Delete cleared edits so that the properties\n\t\t\t\t\t\t\t// are not considered dirty.\n\t\t\t\t\t\t\tif ( nextEdits[ key ] === undefined ) {\n\t\t\t\t\t\t\t\tdelete nextEdits[ key ];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} );\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t...state,\n\t\t\t\t\t\t\t[ action.recordId ]: nextEdits,\n\t\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn state;\n\t\t\t},\n\n\t\t\tsaving: ( state = {}, action ) => {\n\t\t\t\tswitch ( action.type ) {\n\t\t\t\t\tcase 'SAVE_ENTITY_RECORD_START':\n\t\t\t\t\tcase 'SAVE_ENTITY_RECORD_FINISH':\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t...state,\n\t\t\t\t\t\t\t[ action.recordId ]: {\n\t\t\t\t\t\t\t\tpending:\n\t\t\t\t\t\t\t\t\taction.type === 'SAVE_ENTITY_RECORD_START',\n\t\t\t\t\t\t\t\terror: action.error,\n\t\t\t\t\t\t\t\tisAutosave: action.isAutosave,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn state;\n\t\t\t},\n\n\t\t\tdeleting: ( state = {}, action ) => {\n\t\t\t\tswitch ( action.type ) {\n\t\t\t\t\tcase 'DELETE_ENTITY_RECORD_START':\n\t\t\t\t\tcase 'DELETE_ENTITY_RECORD_FINISH':\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t...state,\n\t\t\t\t\t\t\t[ action.recordId ]: {\n\t\t\t\t\t\t\t\tpending:\n\t\t\t\t\t\t\t\t\taction.type ===\n\t\t\t\t\t\t\t\t\t'DELETE_ENTITY_RECORD_START',\n\t\t\t\t\t\t\t\terror: action.error,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn state;\n\t\t\t},\n\t\t} )\n\t);\n}\n\n/**\n * Reducer keeping track of the registered entities.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function entitiesConfig( state = defaultEntities, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'ADD_ENTITIES':\n\t\t\treturn [ ...state, ...action.entities ];\n\t}\n\n\treturn state;\n}\n\n/**\n * Reducer keeping track of the registered entities config and data.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport const entities = ( state = {}, action ) => {\n\tconst newConfig = entitiesConfig( state.config, action );\n\n\t// Generates a dynamic reducer for the entities\n\tlet entitiesDataReducer = state.reducer;\n\tif ( ! entitiesDataReducer || newConfig !== state.config ) {\n\t\tconst entitiesByKind = groupBy( newConfig, 'kind' );\n\t\tentitiesDataReducer = combineReducers(\n\t\t\tObject.entries( entitiesByKind ).reduce(\n\t\t\t\t( memo, [ kind, subEntities ] ) => {\n\t\t\t\t\tconst kindReducer = combineReducers(\n\t\t\t\t\t\tsubEntities.reduce(\n\t\t\t\t\t\t\t( kindMemo, entityConfig ) => ( {\n\t\t\t\t\t\t\t\t...kindMemo,\n\t\t\t\t\t\t\t\t[ entityConfig.name ]: entity( entityConfig ),\n\t\t\t\t\t\t\t} ),\n\t\t\t\t\t\t\t{}\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\n\t\t\t\t\tmemo[ kind ] = kindReducer;\n\t\t\t\t\treturn memo;\n\t\t\t\t},\n\t\t\t\t{}\n\t\t\t)\n\t\t);\n\t}\n\n\tconst newData = entitiesDataReducer( state.data, action );\n\n\tif (\n\t\tnewData === state.data &&\n\t\tnewConfig === state.config &&\n\t\tentitiesDataReducer === state.reducer\n\t) {\n\t\treturn state;\n\t}\n\n\treturn {\n\t\treducer: entitiesDataReducer,\n\t\tdata: newData,\n\t\tconfig: newConfig,\n\t};\n};\n\n/**\n * Reducer keeping track of entity edit undo history.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nconst UNDO_INITIAL_STATE = [];\nUNDO_INITIAL_STATE.offset = 0;\nlet lastEditAction;\nexport function undo( state = UNDO_INITIAL_STATE, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'EDIT_ENTITY_RECORD':\n\t\tcase 'CREATE_UNDO_LEVEL':\n\t\t\tlet isCreateUndoLevel = action.type === 'CREATE_UNDO_LEVEL';\n\t\t\tconst isUndoOrRedo =\n\t\t\t\t! isCreateUndoLevel &&\n\t\t\t\t( action.meta.isUndo || action.meta.isRedo );\n\t\t\tif ( isCreateUndoLevel ) {\n\t\t\t\taction = lastEditAction;\n\t\t\t} else if ( ! isUndoOrRedo ) {\n\t\t\t\t// Don't lose the last edit cache if the new one only has transient edits.\n\t\t\t\t// Transient edits don't create new levels so updating the cache would make\n\t\t\t\t// us skip an edit later when creating levels explicitly.\n\t\t\t\tif (\n\t\t\t\t\tObject.keys( action.edits ).some(\n\t\t\t\t\t\t( key ) => ! action.transientEdits[ key ]\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\tlastEditAction = action;\n\t\t\t\t} else {\n\t\t\t\t\tlastEditAction = {\n\t\t\t\t\t\t...action,\n\t\t\t\t\t\tedits: {\n\t\t\t\t\t\t\t...( lastEditAction && lastEditAction.edits ),\n\t\t\t\t\t\t\t...action.edits,\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet nextState;\n\t\t\tif ( isUndoOrRedo ) {\n\t\t\t\tnextState = [ ...state ];\n\t\t\t\tnextState.offset =\n\t\t\t\t\tstate.offset + ( action.meta.isUndo ? -1 : 1 );\n\n\t\t\t\tif ( state.flattenedUndo ) {\n\t\t\t\t\t// The first undo in a sequence of undos might happen while we have\n\t\t\t\t\t// flattened undos in state. If this is the case, we want execution\n\t\t\t\t\t// to continue as if we were creating an explicit undo level. This\n\t\t\t\t\t// will result in an extra undo level being appended with the flattened\n\t\t\t\t\t// undo values.\n\t\t\t\t\tisCreateUndoLevel = true;\n\t\t\t\t\taction = lastEditAction;\n\t\t\t\t} else {\n\t\t\t\t\treturn nextState;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( ! action.meta.undo ) {\n\t\t\t\treturn state;\n\t\t\t}\n\n\t\t\t// Transient edits don't create an undo level, but are\n\t\t\t// reachable in the next meaningful edit to which they\n\t\t\t// are merged. They are defined in the entity's config.\n\t\t\tif (\n\t\t\t\t! isCreateUndoLevel &&\n\t\t\t\t! Object.keys( action.edits ).some(\n\t\t\t\t\t( key ) => ! action.transientEdits[ key ]\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tnextState = [ ...state ];\n\t\t\t\tnextState.flattenedUndo = {\n\t\t\t\t\t...state.flattenedUndo,\n\t\t\t\t\t...action.edits,\n\t\t\t\t};\n\t\t\t\tnextState.offset = state.offset;\n\t\t\t\treturn nextState;\n\t\t\t}\n\n\t\t\t// Clear potential redos, because this only supports linear history.\n\t\t\tnextState =\n\t\t\t\tnextState || state.slice( 0, state.offset || undefined );\n\t\t\tnextState.offset = nextState.offset || 0;\n\t\t\tnextState.pop();\n\t\t\tif ( ! isCreateUndoLevel ) {\n\t\t\t\tnextState.push( {\n\t\t\t\t\tkind: action.meta.undo.kind,\n\t\t\t\t\tname: action.meta.undo.name,\n\t\t\t\t\trecordId: action.meta.undo.recordId,\n\t\t\t\t\tedits: {\n\t\t\t\t\t\t...state.flattenedUndo,\n\t\t\t\t\t\t...action.meta.undo.edits,\n\t\t\t\t\t},\n\t\t\t\t} );\n\t\t\t}\n\t\t\t// When an edit is a function it's an optimization to avoid running some expensive operation.\n\t\t\t// We can't rely on the function references being the same so we opt out of comparing them here.\n\t\t\tconst comparisonUndoEdits = Object.values(\n\t\t\t\taction.meta.undo.edits\n\t\t\t).filter( ( edit ) => typeof edit !== 'function' );\n\t\t\tconst comparisonEdits = Object.values( action.edits ).filter(\n\t\t\t\t( edit ) => typeof edit !== 'function'\n\t\t\t);\n\t\t\tif ( ! isShallowEqual( comparisonUndoEdits, comparisonEdits ) ) {\n\t\t\t\tnextState.push( {\n\t\t\t\t\tkind: action.kind,\n\t\t\t\t\tname: action.name,\n\t\t\t\t\trecordId: action.recordId,\n\t\t\t\t\tedits: isCreateUndoLevel\n\t\t\t\t\t\t? { ...state.flattenedUndo, ...action.edits }\n\t\t\t\t\t\t: action.edits,\n\t\t\t\t} );\n\t\t\t}\n\t\t\treturn nextState;\n\t}\n\n\treturn state;\n}\n\n/**\n * Reducer managing embed preview data.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function embedPreviews( state = {}, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'RECEIVE_EMBED_PREVIEW':\n\t\t\tconst { url, preview } = action;\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t[ url ]: preview,\n\t\t\t};\n\t}\n\treturn state;\n}\n\n/**\n * State which tracks whether the user can perform an action on a REST\n * resource.\n *\n * @param  {Object} state  Current state.\n * @param  {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function userPermissions( state = {}, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'RECEIVE_USER_PERMISSION':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t[ action.key ]: action.isAllowed,\n\t\t\t};\n\t}\n\n\treturn state;\n}\n\n/**\n * Reducer returning autosaves keyed by their parent's post id.\n *\n * @param  {Object} state  Current state.\n * @param  {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function autosaves( state = {}, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'RECEIVE_AUTOSAVES':\n\t\t\tconst { postId, autosaves: autosavesData } = action;\n\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t[ postId ]: autosavesData,\n\t\t\t};\n\t}\n\n\treturn state;\n}\n\nexport default combineReducers( {\n\tterms,\n\tusers,\n\tcurrentTheme,\n\tcurrentUser,\n\ttaxonomies,\n\tthemes,\n\tthemeSupports,\n\tentities,\n\tundo,\n\tembedPreviews,\n\tuserPermissions,\n\tautosaves,\n\tlocks: locksReducer,\n} );\n"]}